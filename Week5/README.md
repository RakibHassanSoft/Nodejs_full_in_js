# Day 29

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: User Model Setup & Registration**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ, ржЖржорж░рж╛ ржПржХржЯрж┐ User ржоржбрзЗрж▓ рж╕рзЗржЯржЖржк ржХрж░ржм ржПржмржВ ржПржХржЯрж┐ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи ржлрж┐ржЪрж╛рж░ рждрзИрж░рж┐ ржХрж░ржмред ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрж╛ржжрзЗрж░ рждржерзНржп ржкрзНрж░ржжрж╛ржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи ржПржмржВ рждрж╛ MongoDB ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж╕ржВрж░ржХрзНрж╖ржг рж╣ржмрзЗред Express ржПржмржВ Mongoose ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи API рждрзИрж░рж┐ ржХрж░ржмред

---

## тП╕я╕П 1. User ржоржбрзЗрж▓ рждрзИрж░рж┐

ржкрзНрж░ржержорзЗ, ржЖржорж╛ржжрзЗрж░ MongoDB ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рждрзЗ ржПржХржЯрж┐ User ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЦрж╛ржирзЗ, ржЖржорж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо, ржЗржорзЗржЗрж▓, ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржПржмржВ рж░рзЛрж▓ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржмред

### `models/User.js`

```js
const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');

// User ржоржбрзЗрж▓ рждрзИрж░рж┐
const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
  },
  email: {
    type: String,
    required: true,
    unique: true,
  },
  password: {
    type: String,
    required: true,
  },
  role: {
    type: String,
    enum: ['user', 'admin'],
    default: 'user',
  },
});

// ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛
userSchema.pre('save', async function (next) {
  if (!this.isModified('password')) return next();
  
  const salt = await bcrypt.genSalt(10);
  this.password = await bcrypt.hash(this.password, salt);
  next();
});

// ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ
userSchema.methods.matchPassword = async function (password) {
  return await bcrypt.compare(password, this.password);
};

const User = mongoose.model('User', userSchema);

module.exports = User;
```

ржПржЦрж╛ржирзЗ:
- `name`: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо (рж╕рзНржЯрзНрж░рж┐ржВ)ред
- `email`: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЗржорзЗржЗрж▓ (рж╕рзНржЯрзНрж░рж┐ржВ), ржпрж╛ ржЗржЙржирж┐ржХ рж╣ржмрзЗред
- `password`: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб (рж╕рзНржЯрзНрж░рж┐ржВ), ржпрж╛ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЦрждрзЗ рж╣рзНржпрж╛рж╢ ржХрж░рж╛ рж╣ржмрзЗред
- `role`: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржнрзВржорж┐ржХрж╛ (рж╕рзНржЯрзНрж░рж┐ржВ), ржбрж┐ржлрж▓рзНржЯ рж╣рж┐рж╕рж╛ржмрзЗ 'user' ржерж╛ржХржмрзЗ, рждржмрзЗ ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржПржЯрж┐ 'admin'ржУ рж╣рждрзЗ ржкрж╛рж░рзЗред

---

## тП╕я╕П 2. рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж░рж╛ржЙржЯ рждрзИрж░рж┐

ржПржЦржи, ржПржХржЯрж┐ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржм, ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрж╛ржжрзЗрж░ рждржерзНржп ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗржи ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж╕рзЗржЗ рждржерзНржп рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржмрзЗред

### `routes/auth.js`

```js
const express = require('express');
const User = require('../models/User');
const router = express.Router();

// рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж░рж╛ржЙржЯ
router.post('/register', async (req, res) => {
  const { name, email, password, role } = req.body;

  try {
    // ржЪрзЗржХ ржХрж░рзБржи, ржпржжрж┐ ржЗржорзЗржЗрж▓ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржерж╛ржХрзЗ
    const userExists = await User.findOne({ email });
    if (userExists) {
      return res.status(400).json({ message: 'ржЗржорзЗржЗрж▓ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ржирж┐ржмржирзНржзрж┐ржд' });
    }

    // ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░рж╛
    const user = new User({ name, email, password, role });
    await user.save();

    res.status(201).json({
      message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржлрж▓ржнрж╛ржмрзЗ ржирж┐ржмржирзНржзрж┐ржд рж╣рзЯрзЗржЫрзЗ',
      user: { name: user.name, email: user.email, role: user.role },
    });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `/register`: ржПржХржЯрж┐ POST рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ, ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржирж╛ржо, ржЗржорзЗржЗрж▓, ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржПржмржВ рж░рзЛрж▓ ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗржиред
- **ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЪрзЗржХ**: ржпржжрж┐ ржЗрждрж┐ржоржзрзНржпрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржУржЗ ржЗржорзЗржЗрж▓ ржерж╛ржХрзЗ, рждржмрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред
- **ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржВрж░ржХрзНрж╖ржг**: ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА MongoDB ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржмрзЗред

---

## тП╕я╕П 3. Express рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж░рж╛ржЙржЯ ржпрзБржХрзНржд ржХрж░рж╛

ржПржЦржи ржЖржорж╛ржжрзЗрж░ `server.js` ржлрж╛ржЗрж▓рзЗ ржПржЗ рж░рж╛ржЙржЯржЯрж┐ ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛рждрзЗ ржПржЯрж┐ ржХрж╛рж░рзНржпржХрж░рзА рж╣рзЯред

### `server.js`

```js
const express = require('express');
const mongoose = require('mongoose');
const dotenv = require('dotenv');
const bodyParser = require('body-parser');
const authRoutes = require('./routes/auth');

dotenv.config();

const app = express();
const port = process.env.PORT || 3000;

// Middleware
app.use(bodyParser.json());

// MongoDB рж╕ржВржпрзЛржЧ
mongoose.connect(process.env.DB_URI, { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.log('MongoDB connection error:', err));

// рж░рж╛ржЙржЯ ржмрзНржпржмрж╣рж╛рж░
app.use('/api/auth', authRoutes);

// рж╕рж╛рж░рзНржнрж╛рж░ рж╢рзБрж░рзБ
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
```

ржПржЦрж╛ржирзЗ:
- `/api/auth` рж░рж╛ржЙржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ `auth.js` ржлрж╛ржЗрж▓рзЗрж░ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж░рж╛ржЙржЯ рж╕ржВржпрзЛржЧ ржХрж░рждрзЗред

---

## тП╕я╕П 4. ржкрж░рзАржХрзНрж╖рж╛

ржПржЦржи, ржЖржкржирж┐ Postman ржмрж╛ ржпрзЗржХрзЛржирзЛ API ржЯрзЗрж╕рзНржЯрж┐ржВ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ `/register` рж░рж╛ржЙржЯржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### POST Request:
- **URL**: `http://localhost:3000/api/auth/register`
- **Body** (JSON):
  ```json
  {
    "name": "Rakib",
    "email": "rakib@example.com",
    "password": "password123",
    "role": "user"
  }
  ```

- **Response**:
  ```json
  {
    "message": "ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржлрж▓ржнрж╛ржмрзЗ ржирж┐ржмржирзНржзрж┐ржд рж╣рзЯрзЗржЫрзЗ",
    "user": {
      "name": "Rakib",
      "email": "rakib@example.com",
      "role": "user"
    }
  }
  ```

---

## ЁЯУМ In Short:

- **User ржоржбрзЗрж▓ рждрзИрж░рж┐**: MongoDB ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржВрж░ржХрзНрж╖ржг ржПржмржВ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛ред
- **рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи API рждрзИрж░рж┐**: ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржирж┐ржмржирзНржзржи ржХрж░рж╛рж░ ржЬржирзНржп API рждрзИрж░рж┐ ржХрж░рж╛ред
- **Express рж░рж╛ржЙржЯрж┐ржВ**: Express рж╕рж╛рж░рзНржнрж╛рж░рзЗ API рж░рж╛ржЙржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржирж┐ржмржирзНржзржи ржмрзНржпржмрж╕рзНржерж╛ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╢рж┐ржЦрж▓рзЗржи ржПржмржВ MongoDB ржПрж░ рж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ ржЕржнрж┐ржЬрзНржЮрждрж╛ ржЕрж░рзНржЬржи ржХрж░рзЗржЫрзЗржиред ЁЯЪА



# Day 30

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Bcrypt for Hashing**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ, ржЖржорж░рж╛ `bcrypt` ржкрзНржпрж╛ржХрзЗржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢рж┐ржВ рж╢рж┐ржЦржмред ржПржЯрж┐ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржВрж░ржХрзНрж╖ржгрзЗрж░ ржПржХржЯрж┐ ржЬржиржкрзНрж░рж┐рзЯ ржкржжрзНржзрждрж┐ред `bcrypt` ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рждрзЗ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗ, ржпрж╛рждрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рждржерзНржп рж╕рзБрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗред

---

## тП╕я╕П 1. Bcrypt ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи

ржкрзНрж░ржержорзЗ, ржЖржорж╛ржжрзЗрж░ `bcrypt` ржкрзНржпрж╛ржХрзЗржЬржЯрж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛рж░ ржЬржирзНржп ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:

```bash
npm install bcryptjs
```

`bcryptjs` ржПржХржЯрж┐ JavaScript ржнрж┐рждрзНрждрж┐ржХ ржкрзНржпрж╛ржХрзЗржЬ, ржпрж╛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рждрзЗ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣рзЯред ржЖржорж░рж╛ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржм ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕рзБрж░ржХрзНрж╖рж┐рждржнрж╛ржмрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рждрзЗ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржЬржирзНржпред

---

## тП╕я╕П 2. ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢рж┐ржВ

ржПржЦржи ржЖржорж░рж╛ ржжрзЗржЦржм ржХрзАржнрж╛ржмрзЗ ржПржХржЯрж┐ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛ рж╣рзЯред ржоржбрзЗрж▓ржЯрж┐ ржпржЦржи ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждрзИрж░рж┐ ржХрж░ржмрзЗ, рждржЦржи `bcrypt` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржбржЯрж┐ рж╣рзНржпрж╛рж╢ ржХрж░рж╛ рж╣ржмрзЗ, ржпрж╛рждрзЗ ржПржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржирж┐рж░рж╛ржкржжрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ ржпрж╛рзЯред

### `models/User.js`

```js
const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');

// User ржоржбрзЗрж▓ рждрзИрж░рж┐
const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
  },
  email: {
    type: String,
    required: true,
    unique: true,
  },
  password: {
    type: String,
    required: true,
  },
  role: {
    type: String,
    enum: ['user', 'admin'],
    default: 'user',
  },
});

// ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛
userSchema.pre('save', async function (next) {
  if (!this.isModified('password')) return next();
  
  const salt = await bcrypt.genSalt(10); // Salt рждрзИрж░рж┐ ржХрж░рж╛
  this.password = await bcrypt.hash(this.password, salt); // ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛
  next();
});

// ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ
userSchema.methods.matchPassword = async function (password) {
  return await bcrypt.compare(password, this.password); // ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рждрзБрж▓ржирж╛
};

const User = mongoose.model('User', userSchema);

module.exports = User;
```

ржПржЦрж╛ржирзЗ:
- `bcrypt.genSalt(10)`: Salt рждрзИрж░рж┐ ржХрж░рж╛, ржпрж╛ рж╣рзНржпрж╛рж╢рж┐ржВрзЯрзЗрж░ ржЬржирзНржп ржкрзНрж░рзЯрзЛржЬржиред
- `bcrypt.hash()`: ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢ ржХрж░рж╛ред
- `bcrypt.compare()`: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржерж╛ржХрж╛ рж╣рзНржпрж╛рж╢ ржХрж░рж╛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржбрзЗрж░ рждрзБрж▓ржирж╛ ржХрж░рж╛ред

---

## тП╕я╕П 3. ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛

ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржпржЦржи рж▓ржЧржЗржи ржХрж░ржмрзЗ, рждржЦржи ржЖржорж░рж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░ржм ржпрзЗ рждрж╛ржжрзЗрж░ ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржбржЯрж┐ рж╕ржарж┐ржХ ржХрж┐ржирж╛ред ржПржЯрж┐ ржХрж░рждрзЗ, ржЖржорж░рж╛ `bcrypt.compare()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред

### `routes/auth.js`

```js
const express = require('express');
const User = require('../models/User');
const router = express.Router();

// рж▓ржЧржЗржи рж░рж╛ржЙржЯ
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    // ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЗржорзЗржЗрж▓ ржжрж┐рзЯрзЗ ржЦрзЛржБржЬрж╛
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    // ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ
    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓', user: { name: user.name, email: user.email, role: user.role } });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `matchPassword()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред ржПржЯрж┐ `bcrypt.compare()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ, ржПржмржВ ржпржжрж┐ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирж╛ рж╣рзЯ рждржмрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред

---

## тП╕я╕П 4. Express рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж░рж╛ржЙржЯ ржпрзБржХрзНржд ржХрж░рж╛

ржПржЦржи ржЖржорж╛ржжрзЗрж░ `server.js` ржлрж╛ржЗрж▓рзЗ рж▓ржЧржЗржи рж░рж╛ржЙржЯржЯрж┐ ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛рждрзЗ ржПржЯрж┐ ржХрж╛рж░рзНржпржХрж░рзА рж╣рзЯред

### `server.js`

```js
const express = require('express');
const mongoose = require('mongoose');
const dotenv = require('dotenv');
const bodyParser = require('body-parser');
const authRoutes = require('./routes/auth');

dotenv.config();

const app = express();
const port = process.env.PORT || 3000;

// Middleware
app.use(bodyParser.json());

// MongoDB рж╕ржВржпрзЛржЧ
mongoose.connect(process.env.DB_URI, { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.log('MongoDB connection error:', err));

// рж░рж╛ржЙржЯ ржмрзНржпржмрж╣рж╛рж░
app.use('/api/auth', authRoutes);

// рж╕рж╛рж░рзНржнрж╛рж░ рж╢рзБрж░рзБ
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
```

ржПржЦрж╛ржирзЗ:
- `/api/auth/login` рж░рж╛ржЙржЯржЯрж┐ рж▓ржЧржЗржи API рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржмрзЗред

---

## тП╕я╕П 5. ржкрж░рзАржХрзНрж╖рж╛

ржПржЦржи, ржЖржкржирж┐ Postman ржмрж╛ ржпрзЗржХрзЛржирзЛ API ржЯрзЗрж╕рзНржЯрж┐ржВ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ `/login` рж░рж╛ржЙржЯржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### POST Request:
- **URL**: `http://localhost:3000/api/auth/login`
- **Body** (JSON):
  ```json
  {
    "email": "rakib@example.com",
    "password": "password123"
  }
  ```

- **Response**:
  ```json
  {
    "message": "рж▓ржЧржЗржи рж╕ржлрж▓",
    "user": {
      "name": "Rakib",
      "email": "rakib@example.com",
      "role": "user"
    }
  }
  ```

---

## ЁЯУМ In Shor:

- **Bcrypt ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢рж┐ржВ**: рж╕рзБрж░ржХрзНрж╖рж┐ржд ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржВрж░ржХрзНрж╖ржг ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ `bcrypt` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред
- **ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ**: рж▓ржЧржЗржи API рждрзИрж░рж┐ ржХрж░рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢рж┐ржВ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛ рж╢рж┐ржЦрж▓рзЗржи ржПржмржВ `bcrypt` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЕржнрж┐ржЬрзНржЮрждрж╛ ржЕрж░рзНржЬржи ржХрж░рзЗржЫрзЗржиред ЁЯЪА




# Day 31

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: JWT Creation & Verification**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ, ржЖржорж░рж╛ JSON Web Tokens (JWT) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ authentication ржмрзНржпржмрж╕рзНржерж╛ рждрзИрж░рж┐ ржХрж░ржмред JWT ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ, ржЖржкржирж┐ ржирж┐рж░рж╛ржкржжржнрж╛ржмрзЗ рждржерзНржп ржПржХрзНрж╕ржЪрзЗржЮрзНржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржПржЯрж┐ рж╕рж╛ржзрж╛рж░ржгржд ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рж╕рзЗрж╢ржи ржзрж░рзЗ рж░рж╛ржЦрж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред JWT ржПржХржЯрж┐ ржПржиржХрзНрж░рж┐ржкрзНржЯрзЗржб ржЯрзЛржХрзЗржи, ржпрж╛ рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ ржоржзрзНржпрзЗ рж╕рзБрж░ржХрзНрж╖рж┐рждржнрж╛ржмрзЗ рждржерзНржп ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░ ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

---

## тП╕я╕П 1. JWT ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи

ржкрзНрж░ржержорзЗ, JWT ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЬржирзНржп `jsonwebtoken` ржкрзНржпрж╛ржХрзЗржЬржЯрж┐ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ рж╣ржмрзЗред

```bash
npm install jsonwebtoken
```

`jsonwebtoken` ржПржХржЯрж┐ Node.js ржкрзНржпрж╛ржХрзЗржЬ ржпрж╛ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣рзЯред

---

## тП╕я╕П 2. JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рж╛

ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧржЗржи рж╣рж▓рзЗ, рж╕рж╛рж░рзНржнрж╛рж░ ржПржХржЯрж┐ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░ржмрзЗ ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рж╕рзБрж░ржХрзНрж╖рж┐рждржнрж╛ржмрзЗ ржкрзНрж░ржорж╛ржгрж┐ржд ржХрж░рзЗред ржЖржорж░рж╛ `jsonwebtoken` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░ржм ржПржмржВ ржПржЯрж┐ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯржХрзЗ ржкрж╛ржарж╛ржмрзЛред

### `models/User.js`

```js
const jwt = require('jsonwebtoken');

// User ржоржбрзЗрж▓
userSchema.methods.generateAuthToken = function () {
  const token = jwt.sign({ _id: this._id, email: this.email }, process.env.JWT_SECRET, { expiresIn: '1h' });
  return token;
};
```

ржПржЦрж╛ржирзЗ:
- `jwt.sign()` ржкржжрзНржзрждрж┐ржЯрж┐ ржПржХржЯрж┐ ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рзЗред
- ржкрзНрж░ржержо ржЖрж░рзНржЧрзБржорзЗржирзНржЯрзЗ ржЖржорж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ `_id` ржПржмржВ `email` ржкрж╛ржарж╛ржЪрзНржЫрж┐, ржпрзЗржЧрзБрж▓рж┐ ржЯрзЛржХрзЗржирзЗрж░ ржоржзрзНржпрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд ржерж╛ржХржмрзЗред
- ржжрзНржмрж┐рждрзАрзЯ ржЖрж░рзНржЧрзБржорзЗржирзНржЯ рж╣рж▓ `JWT_SECRET` ржпрж╛ ржЯрзЛржХрзЗржиржЯрж┐ ржПржиржХрзНрж░рж┐ржкрзНржЯ ржХрж░рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣рзЯред
- `expiresIn: '1h'` рж╕рзЗржЯрж┐ржВрзЯрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЯрзЛржХрзЗржирзЗрж░ ржорзЗржпрж╝рж╛ржж ржПржХ ржШржгрзНржЯрж╛ред

---

## тП╕я╕П 3. JWT ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛

ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржпржжрж┐ рж▓ржЧржЗржи ржХрж░рзЗ, ржЖржорж░рж╛ ржЯрзЛржХрзЗржиржЯрж┐ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржмрзЛред ржкрж░ржмрж░рзНрждрзА ржпрзЗ ржХрзЛржи API рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗрж░ рж╕ржорзЯ, ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ рж╕рзЗржЗ ржЯрзЛржХрзЗржиржЯрж┐ ржкрж╛ржарж╛ржмрзЗ ржПржмржВ рж╕рж╛рж░рзНржнрж╛рж░ ржПржЯрж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗред

### `middleware/auth.js`

```js
const jwt = require('jsonwebtoken');

const auth = (req, res, next) => {
  const token = req.header('Authorization').replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).send({ message: 'Access denied, token not provided' });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(400).send({ message: 'Invalid token' });
  }
};

module.exports = auth;
```

ржПржЦрж╛ржирзЗ:
- `jwt.verify()` ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣рзЯред ржПржЯрж┐ ржЯрзЛржХрзЗржирзЗрж░ рж╕рждрзНржпрждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ ржПржмржВ ржпржжрж┐ ржЯрзЛржХрзЗржи рж╕ржарж┐ржХ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржЯрж┐ ржбрж┐ржХрзЛржбрзЗржб рждржерзНржп ржлрзЗрж░ржд ржжрзЗрзЯред
- ржпржжрж┐ ржЯрзЛржХрзЗржиржЯрж┐ рж╕ржарж┐ржХ ржирж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржПржХржЯрж┐ рждрзНрж░рзБржЯрж┐ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣рзЯред

---

## тП╕я╕П 4. JWT ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░

ржПржЦржи ржЖржорж░рж╛ ржПржХржЯрж┐ `login` рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╕ржлрж▓ржнрж╛ржмрзЗ рж▓ржЧржЗржи ржХрж░рж▓рзЗ JWT ржЯрзЛржХрзЗржи ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗред

### `routes/auth.js`

```js
const express = require('express');
const User = require('../models/User');
const router = express.Router();

// рж▓ржЧржЗржи рж░рж╛ржЙржЯ
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    const token = user.generateAuthToken();  // ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рж╛
    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓', token });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `generateAuthToken()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржПржмржВ рж╕рзЗржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржлрзЗрж░ржд ржжрзЗржУрзЯрж╛ рж╣ржЪрзНржЫрзЗред

---

## тП╕я╕П 5. JWT ржжрж┐рзЯрзЗ рж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ

ржпрзЗржХрзЛржирзЛ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯрзЗрж░ ржЬржирзНржп, ржЖржорж░рж╛ JWT ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржЬржирзНржп `auth` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред

### `routes/protected.js`

```js
const express = require('express');
const auth = require('../middleware/auth');
const router = express.Router();

// рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ
router.get('/protected', auth, (req, res) => {
  res.status(200).send({ message: 'ржПржЗ рж░рж╛ржЙржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзЗрзЯрзЗржЫрзЗржи', user: req.user });
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `auth` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ JWT ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред
- ржпржжрж┐ ржЯрзЛржХрзЗржи рж╕ржарж┐ржХ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ рж░рж╛ржЙржЯржЯрж┐ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛ржмрзЗ, ржЕржирзНржпржерж╛рзЯ рждрзНрж░рзБржЯрж┐ ржмрж╛рж░рзНрждрж╛ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред

---

## тП╕я╕П 6. ржкрж░рзАржХрзНрж╖рж╛

ржПржЦржи, ржЖржкржирж┐ Postman ржмрж╛ ржпрзЗржХрзЛржирзЛ API ржЯрзЗрж╕рзНржЯрж┐ржВ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ `/login` ржПржмржВ `/protected` рж░рж╛ржЙржЯржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### POST Request:
- **URL**: `http://localhost:3000/api/auth/login`
- **Body** (JSON):
  ```json
  {
    "email": "rakib@example.com",
    "password": "password123"
  }
  ```

- **Response** (Login Success):
  ```json
  {
    "message": "рж▓ржЧржЗржи рж╕ржлрж▓",
    "token": "JWT_TOKEN_HERE"
  }
  ```

### GET Request (Protected Route):
- **URL**: `http://localhost:3000/api/protected/protected`
- **Headers**:
  ```json
  {
    "Authorization": "Bearer JWT_TOKEN_HERE"
  }
  ```

- **Response** (Access Granted):
  ```json
  {
    "message": "ржПржЗ рж░рж╛ржЙржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзЗрзЯрзЗржЫрзЗржи",
    "user": {
      "_id": "USER_ID",
      "email": "rakib@example.com"
    }
  }
  ```

---

## ЁЯУМ In Short:

- **JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржУ ржпрж╛ржЪрж╛ржЗ**: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рж▓ржЧржЗржи рж╣рж▓рзЗ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржПржмржВ рж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯрзЗ ржПржЯрж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ред
- **JWT middleware**: ржирж┐рж░рж╛ржкржж рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕рзЗрж░ ржЬржирзНржп JWT ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗ ржЖржкржирж┐ JWT ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржирж┐рж░рж╛ржкржж ржЕржерзЗржиржЯрж┐ржХрзЗрж╢ржи ржмрзНржпржмрж╕рзНржерж╛ рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржи ржПржмржВ ржПржЯрж┐ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ-рж╕рж╛рж░рзНржнрж╛рж░ ржпрзЛржЧрж╛ржпрзЛржЧрзЗрж░ ржоржзрзНржпрзЗ рж╕рзБрж░ржХрзНрж╖рж╛ ржПржирзЗржЫрзЗред ЁЯЪА




# Day 32

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Login + Protect Routes**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ, ржЖржорж░рж╛ JWT ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓ржЧржЗржи ржмрзНржпржмрж╕рзНржерж╛ рждрзИрж░рж┐ ржХрж░ржмрзЛ ржПржмржВ рж░рж╛ржЙржЯржЧрзБрж▓рзЛржХрзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд (protected) рж░рж╛ржЦржмред ржПрж░ ржорж╛ржзрзНржпржорзЗ, ржЖржкржирж┐ рж╢рзБржзрзБ рж▓ржЧржЗржи ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред 

---

## тП╕я╕П 1. рж▓ржЧржЗржи ржлрж┐ржЪрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛

ржкрзНрж░ржержорзЗ, ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рж▓ржЧржЗржи ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░ржмрзЛред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ `email` ржПржмржВ `password` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░ржмрзЛред рж╕ржлрж▓ рж▓ржЧржЗржирзЗрж░ ржкрж░ ржПржХржЯрж┐ JWT ржЯрзЛржХрзЗржи ржлрж┐рж░рж┐рзЯрзЗ ржжрзЗржУрзЯрж╛ рж╣ржмрзЗ ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржЕржирзНржпрж╛ржирзНржп рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯрзЗ ржкрзНрж░ржмрзЗрж╢ ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗред

### `models/User.js`

```js
const jwt = require('jsonwebtoken');

// User ржоржбрзЗрж▓
userSchema.methods.generateAuthToken = function () {
  const token = jwt.sign({ _id: this._id, email: this.email }, process.env.JWT_SECRET, { expiresIn: '1h' });
  return token;
};
```

ржПржЦрж╛ржирзЗ:
- `generateAuthToken()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ `_id` ржПржмржВ `email` ржирж┐рзЯрзЗ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░ржЫрзЗред ржЯрзЛржХрзЗржиржЯрж┐ 1 ржШржгрзНржЯрж╛ ржкрж░рзНржпржирзНржд ржмрзИржз ржерж╛ржХржмрзЗред

---

## тП╕я╕П 2. рж▓ржЧржЗржи рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░рж╛

ржЖржорж░рж╛ ржПржХржЯрж┐ POST рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рж▓ржЧржЗржи ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗ ржПржмржВ JWT ржЯрзЛржХрзЗржи ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗред

### `routes/auth.js`

```js
const express = require('express');
const User = require('../models/User');
const router = express.Router();

// рж▓ржЧржЗржи рж░рж╛ржЙржЯ
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    const token = user.generateAuthToken();  // ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рж╛
    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓', token });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ `email` ржПржмржВ `password` ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред ржпржжрж┐ рж╕ржарж┐ржХ рж╣рзЯ, рждржмрзЗ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржПржмржВ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯржХрзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржЪрзНржЫрзЗред

---

## тП╕я╕П 3. рж░рж╛ржЙржЯ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рж╛

ржПржЦржи ржЖржорж░рж╛ ржПржХржЯрж┐ middleware рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ JWT ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗ ржПржмржВ рж░рж╛ржЙржЯржЯрж┐ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░ржмрзЗред ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЗ ржпрзЗ рж╢рзБржзрзБ рж▓ржЧржЗржи ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░рж╛ржЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред

### `middleware/auth.js`

```js
const jwt = require('jsonwebtoken');

const auth = (req, res, next) => {
  const token = req.header('Authorization').replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).send({ message: 'ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНрж░рждрзНржпрж╛ржЦрзНржпрж╛ржи, ржЯрзЛржХрзЗржи ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣рзЯржирж┐' });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    res.status(400).send({ message: 'ржЕржХрж╛рж░рзНржпржХрж░ ржЯрзЛржХрзЗржи' });
  }
};

module.exports = auth;
```

ржПржЦрж╛ржирзЗ:
- `Authorization` рж╣рзЗржбрж╛рж░рзЗ ржкрзНрж░рж╛ржкрзНржд ржЯрзЛржХрзЗржиржЯрж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред
- ржпржжрж┐ ржЯрзЛржХрзЗржи рж╕ржарж┐ржХ рж╣рзЯ, рждржмрзЗ `req.user` рждрзЗ ржбрж┐ржХрзЛржбрзЗржб рждржерзНржп рж╕рзЗржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржПржмржВ ржкрж░ржмрж░рзНрждрзА рж░рж╛ржЙржЯрзЗ ржпрж╛ржУрзЯрж╛ рж╣ржЪрзНржЫрзЗред

---

## тП╕я╕П 4. рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░рж╛

ржПржЦржи ржЖржорж░рж╛ ржПржХржЯрж┐ GET рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ рж▓ржЧржЗржи ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░рж╛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред ржПржЗ рж░рж╛ржЙржЯрзЗ `auth` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржмрзЗ ржпрж╛ JWT ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗред

### `routes/protected.js`

```js
const express = require('express');
const auth = require('../middleware/auth');
const router = express.Router();

// рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ
router.get('/protected', auth, (req, res) => {
  res.status(200).send({ message: 'ржПржЗ рж░рж╛ржЙржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзЗрзЯрзЗржЫрзЗржи', user: req.user });
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `auth` middleware рж░рж╛ржЙржЯрзЗ ржпрзБржХрзНржд ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ ржпрж╛ JWT ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржжрзЗрзЯред

---

## тП╕я╕П 5. рж▓ржЧржЗржи ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛

ржПржЦржи, ржЖржкржирж┐ Postman ржмрж╛ ржпрзЗржХрзЛржирзЛ API ржЯрзЗрж╕рзНржЯрж┐ржВ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ `/login` ржПржмржВ `/protected` рж░рж╛ржЙржЯржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### POST Request (Login):
- **URL**: `http://localhost:3000/api/auth/login`
- **Body** (JSON):
  ```json
  {
    "email": "rakib@example.com",
    "password": "password123"
  }
  ```

- **Response** (Login Success):
  ```json
  {
    "message": "рж▓ржЧржЗржи рж╕ржлрж▓",
    "token": "JWT_TOKEN_HERE"
  }
  ```

### GET Request (Protected Route):
- **URL**: `http://localhost:3000/api/protected/protected`
- **Headers**:
  ```json
  {
    "Authorization": "Bearer JWT_TOKEN_HERE"
  }
  ```

- **Response** (Access Granted):
  ```json
  {
    "message": "ржПржЗ рж░рж╛ржЙржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзЗрзЯрзЗржЫрзЗржи",
    "user": {
      "_id": "USER_ID",
      "email": "rakib@example.com"
    }
  }
  ```

---

## ЁЯУМ In Short:

- **рж▓ржЧржЗржи рж╕рж┐рж╕рзНржЯрзЗржо**: JWT ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓ржЧржЗржи ржмрзНржпржмрж╕рзНржерж╛ рждрзИрж░рж┐ ржХрж░рж╛ред
- **рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ**: JWT ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ рж░рж╛ржЙржЯ рж╕рзБрж░ржХрзНрж╖рж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ ржПржмржВ рж╢рзБржзрзБржорж╛рждрзНрж░ рж▓ржЧржЗржи ржХрж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп ржХрж░рж╛ред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗ ржЖржкржирж┐ JWT ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓ржЧржЗржи ржмрзНржпржмрж╕рзНржерж╛ ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржиред ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржПржЦржи ржирж┐рж░рж╛ржкржжржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рж╕рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ рж╕ржХрзНрж╖ржоред ЁЯЪА




# Day 33

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Refresh Token System**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ, ржЖржорж░рж╛ **Refresh Token System** рждрзИрж░рж┐ ржХрж░ржмрзЛ, ржпрж╛ JWT ржЯрзЛржХрзЗржирзЗрж░ ржорзЗрзЯрж╛ржж рж╢рзЗрж╖ рж╣ржУрзЯрж╛рж░ ржкрж░рзЗржУ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзБржирж░рж╛рзЯ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржмрзЗред Refresh token ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржирждрзБржи access token ржкрзЗрждрзЗ рж╕рж╣рж╛рзЯрждрж╛ ржХрж░ржмрзЗ ржПржмржВ ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рж▓ржЧ ржЖржЙржЯ ржирж╛ ржХрж░рзЗржЗ ржирждрзБржи ржЯрзЛржХрзЗржи ржкрзЗрждрзЗ рж╕ржХрзНрж╖ржо ржХрж░ржмрзЗред

---

## тП╕я╕П 1. Refresh Token ржХрж┐?

Refresh token ржПржХржЯрж┐ ржмрж┐рж╢рзЗрж╖ ржзрж░ржирзЗрж░ ржЯрзЛржХрзЗржи ржпрж╛ рж╕рж╛ржзрж╛рж░ржгржд ржПржХржЯрж┐ ржжрзАрж░рзНржШ ржорзЗрзЯрж╛ржжрзА ржерж╛ржХрзЗред ржПржЯрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржирждрзБржи access token ржкрж╛ржУрзЯрж╛рж░ рж╕рзБржпрзЛржЧ ржжрзЗрзЯ, ржХрж┐ржирзНрждрзБ рж╕рж░рж╛рж╕рж░рж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓ ржХрж░рзЗ ржирж╛ред ржпржЦржи **access token** ржорзЗрзЯрж╛ржж рж╢рзЗрж╖ рж╣рзЯрзЗ ржпрж╛рзЯ, рждржЦржи **refresh token** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ ржирждрзБржи access token рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛рзЯред

---

## тП╕я╕П 2. Refresh Token рждрзИрж░рж┐ ржУ рж╕ржВрж░ржХрзНрж╖ржг

ржкрзНрж░ржержорзЗ, ржЖржорж░рж╛ ржПржХржЯрж┐ ржирждрзБржи refresh token рждрзИрж░рж┐ ржХрж░ржмрзЛ ржПржмржВ рж╕рзЗржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржмрзЛред

### `models/User.js`

```js
const jwt = require('jsonwebtoken');

// User ржоржбрзЗрж▓
userSchema.methods.generateAuthToken = function () {
  const token = jwt.sign({ _id: this._id, email: this.email }, process.env.JWT_SECRET, { expiresIn: '1h' });
  return token;
};

// Refresh token рждрзИрж░рж┐ ржХрж░рж╛
userSchema.methods.generateRefreshToken = function () {
  const refreshToken = jwt.sign({ _id: this._id, email: this.email }, process.env.JWT_SECRET, { expiresIn: '7d' });
  return refreshToken;
};
```

ржПржЦрж╛ржирзЗ:
- `generateRefreshToken()` ржорзЗржержбржЯрж┐ ржПржХржЯрж┐ ржирждрзБржи refresh token рждрзИрж░рж┐ ржХрж░ржЫрзЗ, ржпрж╛рж░ ржорзЗрзЯрж╛ржж 7 ржжрж┐ржи рж╣ржмрзЗред

---

## тП╕я╕П 3. Refresh Token рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░рж╛

ржПржЦржи ржЖржорж░рж╛ ржПржХржЯрж┐ рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ, ржпрж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ **refresh token** ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗ, ржпрж╛рждрзЗ рждрж╛рж░рж╛ ржкрзБрж░рзЛржирзЛ **access token** ржПрж░ ржорзЗрзЯрж╛ржж рж╢рзЗрж╖ рж╣рж▓рзЗ ржПржХржЯрж┐ ржирждрзБржи token ржкрзЗрждрзЗ ржкрж╛рж░рзЗред

### `routes/auth.js`

```js
const express = require('express');
const User = require('../models/User');
const jwt = require('jsonwebtoken');
const router = express.Router();

// Refresh Token рж░рж╛ржЙржЯ
router.post('/refresh-token', async (req, res) => {
  const { refreshToken } = req.body;
  
  if (!refreshToken) {
    return res.status(401).json({ message: 'Refresh token ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣рзЯржирж┐' });
  }

  try {
    const decoded = jwt.verify(refreshToken, process.env.JWT_SECRET);
    const user = await User.findOne({ _id: decoded._id });

    if (!user) {
      return res.status(404).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const newAccessToken = user.generateAuthToken(); // ржирждрзБржи access token рждрзИрж░рж┐ ржХрж░рж╛
    res.status(200).json({ accessToken: newAccessToken });
  } catch (error) {
    res.status(400).json({ message: 'ржЕржХрж╛рж░рзНржпржХрж░ refresh token' });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `refresh-token` рж░рж╛ржЙржЯрзЗ `refreshToken` ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржЪрж╛ржУрзЯрж╛ рж╣ржЪрзНржЫрзЗред ржПржЯрж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржкрж░ ржПржХржЯрж┐ ржирждрзБржи access token рждрзИрж░рж┐ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред

---

## тП╕я╕П 4. Refresh Token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж▓ржЧржЗржи

ржЖржорж░рж╛ ржПржХржЯрж┐ POST рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ, ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржержорзЗ рж▓ржЧржЗржи ржХрж░рж╛рж░ рж╕ржорзЯ ржжрзБржЯрж┐ ржЯрзЛржХрзЗржи ржкрж╛ржмрзЗ: ржПржХржЯрж┐ access token ржПржмржВ ржПржХржЯрж┐ refresh tokenред

### `routes/auth.js`

```js
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    const accessToken = user.generateAuthToken();
    const refreshToken = user.generateRefreshToken(); // Refresh token рждрзИрж░рж┐ ржХрж░рж╛

    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓', accessToken, refreshToken });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});
```

ржПржЦрж╛ржирзЗ:
- `login` рж░рж╛ржЙржЯржЯрж┐ ржмрзНржпржмрж╣рзГржд рж╣рзЯ ржирждрзБржи **access token** ржПржмржВ **refresh token** ржкрзНрж░ржжрж╛ржи ржХрж░рж╛рж░ ржЬржирзНржпред

---

## тП╕я╕П 5. Token Refresh Flow

1. **Login**: ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрзНрж░ржержорзЗ рж▓ржЧржЗржи ржХрж░рзЗ access token ржПржмржВ refresh token ржкрж╛рзЯред
2. **Token Expiry**: ржпржЦржи access token ржПрж░ ржорзЗрзЯрж╛ржж рж╢рзЗрж╖ рж╣рзЯрзЗ ржпрж╛рзЯ, ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА refresh token ржжрж┐рзЯрзЗ ржирждрзБржи access token ржкрзЗрждрзЗ ржкрж╛рж░рзЗред
3. **New Access Token**: `POST /refresh-token` рж░рж╛ржЙржЯрзЗ refresh token ржкрж╛ржарж┐рзЯрзЗ ржирждрзБржи access token ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

---

## тП╕я╕П 6. рж▓ржЧржЗржи ржУ Refresh Token ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛

ржПржЦржи ржЖржкржирж┐ Postman ржмрж╛ ржпрзЗржХрзЛржирзЛ API ржЯрзЗрж╕рзНржЯрж┐ржВ ржЯрзБрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ `/login` ржПржмржВ `/refresh-token` рж░рж╛ржЙржЯржЧрзБрж▓рзЛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

### POST Request (Login):
- **URL**: `http://localhost:3000/api/auth/login`
- **Body** (JSON):
  ```json
  {
    "email": "rakib@example.com",
    "password": "password123"
  }
  ```

- **Response** (Login Success):
  ```json
  {
    "message": "рж▓ржЧржЗржи рж╕ржлрж▓",
    "accessToken": "NEW_ACCESS_TOKEN_HERE",
    "refreshToken": "NEW_REFRESH_TOKEN_HERE"
  }
  ```

### POST Request (Refresh Token):
- **URL**: `http://localhost:3000/api/auth/refresh-token`
- **Body** (JSON):
  ```json
  {
    "refreshToken": "EXISTING_REFRESH_TOKEN_HERE"
  }
  ```

- **Response** (New Access Token):
  ```json
  {
    "accessToken": "NEW_ACCESS_TOKEN_HERE"
  }
  ```

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **Refresh Token System**: Refresh token рждрзИрж░рж┐ ржПржмржВ рж╕рзЗржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржирждрзБржи access token ржкрж╛ржУрзЯрж╛ред
- **Security**: Refresh token ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржирж┐рж░рж╛ржкржжржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржжрзАрж░рзНржШржХрж╛рж▓рзАржи рж╕рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи, рждрж╛ржжрзЗрж░ ржкрзБржирж░рж╛рзЯ рж▓ржЧржЗржи ржирж╛ ржХрж░рж┐рзЯрзЗред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗ ржЖржкржирж┐ JWT ржПрж░ рж╕рж╛рж╣рж╛ржпрзНржпрзЗ Refresh token рж╕рж┐рж╕рзНржЯрзЗржо рждрзИрж░рж┐ ржХрж░рзЗржЫрзЗржи, ржпрж╛ ржирж┐рж░рж╛ржкржж ржПржмржВ ржХрж╛рж░рзНржпржХрж░ рж╕рзЗрж╢ржи ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЗред ЁЯЪА





# Day 34

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: JWT Store in HTTP-only Cookie**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрзАржнрж╛ржмрзЗ **JWT (JSON Web Token)** ржХрзЗ **HTTP-only Cookie**-рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ ржпрж╛рзЯред ржПржЗ ржкржжрзНржзрждрж┐ржЯрж┐ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрзГржжрзНржзрж┐рж░ ржЬржирзНржп ржмрзНржпржмрж╣рзГржд рж╣рзЯ, ржпрзЗржЦрж╛ржирзЗ ржЯрзЛржХрзЗржи ржХрзНрж▓рж╛рзЯрзЗржирзНржЯ рж╕рж╛ржЗржбрзЗрж░ JavaScript ржерзЗржХрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛рзЯ ржирж╛, ржПржЯрж┐ ржХрзЗржмрж▓ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рж╛ржЗржбрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржмрзЗред ржПрж░ ржлрж▓рзЗ XSS (Cross-Site Scripting) ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

---

## тП╕я╕П 1. HTTP-only Cookie ржХрж┐?

**HTTP-only Cookie** ржПржХржЯрж┐ ржмрж┐рж╢рзЗрж╖ ржзрж░ржирзЗрж░ cookie ржпрж╛ **JavaScript** ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛рзЯ ржирж╛, рж╢рзБржзрзБржорж╛рждрзНрж░ HTTP рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржПржЯрж┐ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрж╛ржарж╛ржирзЛ рж╣рзЯред ржПржЯрж┐ ржирж┐рж░рж╛ржкржж ржПржмржВ рж╣рзНржпрж╛ржХрж╛рж░ржжрзЗрж░ ржЬржирзНржп рж╕ржорж╕рзНржпрж╛рж░ рж╕рзГрж╖рзНржЯрж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржирж╛, ржХрж╛рж░ржг рждрж╛рж░рж╛ JavaScript ржжрж┐рзЯрзЗ ржПржЗ cookie рждрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛ред

---

## тП╕я╕П 2. JWT ржХрзЗ HTTP-only Cookie рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг

ржкрзНрж░ржержорзЗ, ржЖржорж░рж╛ ржПржХржЯрж┐ JWT ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░ржмрзЛ ржПржмржВ рж╕рзЗржЯрж┐ **HTTP-only Cookie** рж╣рж┐рж╕рзЗржмрзЗ ржХрзНрж▓рж╛рзЯрзЗржирзНржЯрзЗ ржкрж╛ржарж╛ржмрзЛред ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧржЗржи ржХрж░ржмрзЗ, рждржЦржи ржЖржорж░рж╛ ржЯрзЛржХрзЗржиржЯрж┐ HTTP-only Cookie рждрзЗ рж╕рзЗржЯ ржХрж░ржмрзЛред

### `routes/auth.js`

```js
const express = require('express');
const jwt = require('jsonwebtoken');
const User = require('../models/User');
const router = express.Router();

// рж▓ржЧржЗржи рж░рж╛ржЙржЯ
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    const accessToken = user.generateAuthToken();
    const refreshToken = user.generateRefreshToken(); // Refresh token рждрзИрж░рж┐ ржХрж░рж╛

    // HTTP-only cookie рждрзЗ JWT ржЯрзЛржХрзЗржи рж╕рзЗржЯ ржХрж░рж╛
    res.cookie('accessToken', accessToken, {
      httpOnly: true, // cookie-ржЯрж┐ JavaScript ржжрж┐рзЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ржпрзЛржЧрзНржп рж╣ржмрзЗ ржирж╛
      secure: process.env.NODE_ENV === 'production', // Production ржорзЛржбрзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж╕ржВржпрзЛржЧ (https) рж╣ржмрзЗ
      maxAge: 60 * 60 * 24 * 7 * 1000, // cookie ржПрж░ ржорзЗрзЯрж╛ржж 7 ржжрж┐ржи
    });

    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓', refreshToken });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- ржЖржорж░рж╛ **access token** HTTP-only cookie рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржЫрж┐ред
- `httpOnly: true` ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ cookie рждрзЗ JavaScript ржжрж┐рзЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛ред
- `secure: process.env.NODE_ENV === 'production'` ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ cookie рж╢рзБржзрзБржорж╛рждрзНрж░ ржирж┐рж░рж╛ржкржж (HTTPS) ржкрж░рж┐ржмрзЗрж╢рзЗ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред

---

## тП╕я╕П 3. Token Verification with HTTP-only Cookie

ржПржЦржи, ржЖржорж░рж╛ ржПржХржЯрж┐ рж░рж╛ржЙржЯ рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ HTTP-only cookie ржерзЗржХрзЗ JWT ржЯрзЛржХрзЗржи ржмрзЗрж░ ржХрж░ржмрзЗ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░ржмрзЗред ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржпржЦржи рждрж╛рж░ token ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ, рждржЦржи ржПржЗ cookie ржерзЗржХрзЗ ржЯрзЛржХрзЗржи ржкрзЬрж╛ рж╣ржмрзЗред

### `middlewares/auth.js`

```js
const jwt = require('jsonwebtoken');

const authenticateToken = (req, res, next) => {
  const token = req.cookies.accessToken; // HTTP-only cookie ржерзЗржХрзЗ JWT ржЯрзЛржХрзЗржи ржкрзЬрж╛

  if (!token) {
    return res.status(401).json({ message: 'ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рзБржи' });
  }

  jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {
    if (err) {
      return res.status(403).json({ message: 'ржЕржХрж╛рж░рзНржпржХрж░ ржЯрзЛржХрзЗржи' });
    }
    req.user = decoded;
    next();
  });
};

module.exports = authenticateToken;
```

ржПржЦрж╛ржирзЗ:
- ржЖржорж░рж╛ `req.cookies.accessToken` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ HTTP-only cookie ржерзЗржХрзЗ JWT ржЯрзЛржХрзЗржи ржЧрзНрж░рж╣ржг ржХрж░ржЫрж┐ред
- ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛рж░ ржкрж░ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рждржерзНржп `req.user` ржП рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ, ржпрж╛рждрзЗ ржкрж░ржмрж░рзНрждрзА ржорзЗржержбрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛рзЯред

---

## тП╕я╕П 4. Token Verification Middleware ржмрзНржпржмрж╣рж╛рж░

ржПржЦржи ржЖржорж░рж╛ ржЖржорж╛ржжрзЗрж░ secured рж░рж╛ржЙржЯржЧрзБрж▓рзЛрждрзЗ `authenticateToken` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛ, ржпрж╛рждрзЗ ржпрзЗржХрзЛржирзЛ ржкрзНрж░ржЯрзЗржХрзНржЯрзЗржб рж░рж╛ржЙржЯрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржкрзНрж░ржмрзЗрж╢ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржпржЦржи рждрж╛рж░ ржЯрзЛржХрзЗржи ржмрзИржз ржерж╛ржХрзЗред

### `routes/protected.js`

```js
const express = require('express');
const authenticateToken = require('../middlewares/auth');
const router = express.Router();

// Protected Route Example
router.get('/protected', authenticateToken, (req, res) => {
  res.status(200).json({ message: 'ржПржЯрж┐ ржПржХржЯрж┐ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ', user: req.user });
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `authenticateToken` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ, ржпрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ рж╢рзБржзрзБ ржмрзИржз ржЯрзЛржХрзЗржиржзрж╛рж░рзА ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░рж╛ржЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред

---

## тП╕я╕П 5. Cookie Delete (Logout) ржХрж░рж╛

ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧржЖржЙржЯ ржХрж░ржмрзЗ, рждржЦржи ржЖржорж░рж╛ рждрж╛ржжрзЗрж░ cookie ржорзБржЫрзЗ ржжрзЗржмрзЛред ржПржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ рж╕рзЗрж╢ржи рж╢рзЗрж╖ ржХрж░рж╛рж░ ржЬржирзНржп рж╕рж╣рж╛рзЯржХ рж╣ржмрзЗред

### `routes/auth.js`

```js
router.post('/logout', (req, res) => {
  res.clearCookie('accessToken'); // Cookie ржорзБржЫрзЗ ржлрзЗрж▓рж╛
  res.status(200).json({ message: 'рж▓ржЧржЖржЙржЯ рж╕ржлрж▓' });
});
```

ржПржЦрж╛ржирзЗ:
- `res.clearCookie('accessToken')` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржорж░рж╛ `accessToken` cookie ржорзБржЫрзЗ ржжрж┐ржЪрзНржЫрж┐, ржпрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧржЖржЙржЯ рж╣ржмрзЗред

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **JWT ржЯрзЛржХрзЗржиржХрзЗ HTTP-only Cookie рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛**: ржирж┐рж░рж╛ржкржжржнрж╛ржмрзЗ ржЯрзЛржХрзЗржи рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ ржПржмржВ рждрж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕рж╛рж░рзНржнрж╛рж░ рж╕рж╛ржЗржбрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржУрзЯрж╛ред
- **Token Verification**: HTTP-only cookie ржерзЗржХрзЗ ржЯрзЛржХрзЗржи ржирж┐рзЯрзЗ рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ред
- **Security**: JavaScript ржерзЗржХрзЗ ржЯрзЛржХрзЗржи ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржирж╛ рж╣ржУрзЯрж╛рж░ ржлрж▓рзЗ XSS ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж╕рзБрж░ржХрзНрж╖рж╛ ржкрж╛ржУрзЯрж╛ред

ржЖржЬржХрзЗрж░ ржкрзНрж░ржХрж▓рзНржкрзЗ ржЖржкржирж┐ JWT ржЯрзЛржХрзЗржиржХрзЗ HTTP-only cookie рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯржЧрзБрж▓рзЛрж░ ржЬржирзНржп рждрж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ рж╢рж┐ржЦрзЗржЫрзЗржиред ЁЯЪА






# Day 35

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Auth System рж╕ржорзНржкрзВрж░рзНржг ржХрж░рж╛ ржПржмржВ ржЯрзЗрж╕рзНржЯрж┐ржВ**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ **Auth System** рж╕ржорзНржкрзВрж░рзНржг ржХрж░ржмрзЛ ржПржмржВ ржПрж░ рж╕ржорж╕рзНржд ржлрж╛ржВрж╢ржирж╛рж▓рж┐ржЯрж┐ ржкрж░рзАржХрзНрж╖рж╛ (testing) ржХрж░ржмрзЛред ржЖржорж░рж╛ ржирж┐рж╢рзНржЪрж┐ржд рж╣ржмрзЛ ржпрзЗ рж╕рж┐рж╕рзНржЯрзЗржоржЯрж┐ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржПржмржВ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред

---

## тП╕я╕П 1. Authentication System рж╕ржорзНржкрзВрж░рзНржг ржХрж░рж╛

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ **JWT authentication** рж╕рж┐рж╕рзНржЯрзЗржо рж╕ржорзНржкрзВрж░рзНржг ржХрж░ржмрзЛ ржПржмржВ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░ржмрзЛ ржпрзЗ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи, рж▓ржЧржЗржи, ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯржЧрзБрж▓рзЛ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗред ржЖржорж░рж╛ ржПрж░ ржоржзрзНржпрзЗ ржерж╛ржХржмрзЗ:

1. **User Registration** (ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╣рзНржпрж╛рж╢рж┐ржВрж╕рж╣)
2. **User Login** (JWT рждрзИрж░рж┐)
3. **Token Storage** (HTTP-only Cookie рждрзЗ ржЯрзЛржХрзЗржи рж╕ржВрж░ржХрзНрж╖ржг)
4. **Token Verification** (ржкрзНрж░рждрж┐ржЯрж┐ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛)
5. **Logout** (ржЯрзЛржХрзЗржи ржорзБржЫрзЗ ржлрзЗрж▓рж╛)

### `routes/auth.js`

```js
const express = require('express');
const jwt = require('jsonwebtoken');
const bcrypt = require('bcryptjs');
const User = require('../models/User');
const router = express.Router();

// рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж░рж╛ржЙржЯ
router.post('/register', async (req, res) => {
  const { email, password } = req.body;

  try {
    const userExists = await User.findOne({ email });
    if (userExists) {
      return res.status(400).json({ message: 'ржЗржорзЗржЗрж▓ ржЗрждрж┐ржоржзрзНржпрзЗ рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ' });
    }

    const hashedPassword = await bcrypt.hash(password, 10);
    const newUser = new User({ email, password: hashedPassword });
    await newUser.save();
    res.status(201).json({ message: 'рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи рж╕ржлрж▓' });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

// рж▓ржЧржЗржи рж░рж╛ржЙржЯ
router.post('/login', async (req, res) => {
  const { email, password } = req.body;

  try {
    const user = await User.findOne({ email });
    if (!user) {
      return res.status(400).json({ message: 'ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐' });
    }

    const isMatch = await bcrypt.compare(password, user.password);
    if (!isMatch) {
      return res.status(400).json({ message: 'ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб рж╕ржарж┐ржХ ржирзЯ' });
    }

    const token = jwt.sign({ userId: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });
    res.cookie('accessToken', token, {
      httpOnly: true,
      secure: process.env.NODE_ENV === 'production',
      maxAge: 60 * 60 * 1000, // 1 hour
    });

    res.status(200).json({ message: 'рж▓ржЧржЗржи рж╕ржлрж▓' });
  } catch (error) {
    res.status(500).json({ message: 'рж╕рж╛рж░рзНржнрж╛рж░ рждрзНрж░рзБржЯрж┐', error: error.message });
  }
});

// рж▓ржЧржЖржЙржЯ рж░рж╛ржЙржЯ
router.post('/logout', (req, res) => {
  res.clearCookie('accessToken');
  res.status(200).json({ message: 'рж▓ржЧржЖржЙржЯ рж╕ржлрж▓' });
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи, рж▓ржЧржЗржи ржПржмржВ рж▓ржЧржЖржЙржЯ рж░рж╛ржЙржЯржЧрзБрж▓рзЛрж░ ржоржзрзНржпрзЗ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред
- рж▓ржЧржЗржи рж╕ржлрж▓ рж╣рж▓рзЗ JWT ржЯрзЛржХрзЗржи HTTP-only Cookie рждрзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ рж╣рзЯред

---

## тП╕я╕П 2. Token Verification Middleware

ржПржЗ ржорзЗржЯрзЛржбржЯрж┐ ржкрзНрж░ржЯрзЗржХрзНржЯрзЗржб рж░рж╛ржЙржЯржЧрзБрж▓рзЛрждрзЗ ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рждрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржмрзЗред

### `middlewares/auth.js`

```js
const jwt = require('jsonwebtoken');

const authenticateToken = (req, res, next) => {
  const token = req.cookies.accessToken;

  if (!token) {
    return res.status(401).json({ message: 'ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ рж▓ржЧржЗржи ржХрж░рзБржи' });
  }

  jwt.verify(token, process.env.JWT_SECRET, (err, decoded) => {
    if (err) {
      return res.status(403).json({ message: 'ржЕржХрж╛рж░рзНржпржХрж░ ржЯрзЛржХрзЗржи' });
    }
    req.user = decoded;
    next();
  });
};

module.exports = authenticateToken;
```

ржПржЦрж╛ржирзЗ:
- ржЖржорж░рж╛ `authenticateToken` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрж┐ ржпрзЗржЯрж┐ HTTP-only cookie ржерзЗржХрзЗ ржЯрзЛржХрзЗржи ржмрзЗрж░ ржХрж░рзЗ ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗред

---

## тП╕я╕П 3. Protected Routes

ржПржЗ рж░рж╛ржЙржЯржЧрзБрж▓рзЛ рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛ржмрзЗ ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЯрзЛржХрзЗржи ржмрзИржз ржерж╛ржХржмрзЗред

### `routes/protected.js`

```js
const express = require('express');
const authenticateToken = require('../middlewares/auth');
const router = express.Router();

router.get('/protected', authenticateToken, (req, res) => {
  res.status(200).json({ message: 'ржПржЯрж┐ ржПржХржЯрж┐ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ', user: req.user });
});

module.exports = router;
```

ржПржЦрж╛ржирзЗ:
- `authenticateToken` middleware ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржорж░рж╛ рж░рж╛ржЙржЯржЯрж┐ржХрзЗ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░рзЗржЫрж┐ред

---

## тП╕я╕П 4. Testing

ржПржЦржи, ржЖржкржирж┐ **Postman** ржмрж╛ **Insomnia** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржкрзБрж░рзЛ Auth System ржЯрзЗрж╕рзНржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржЯрзЗрж╕рзНржЯржЧрзБрж▓рзЛ ржХрж░рждрзЗ рж╣ржмрзЗ:

1. **POST /register**: ржирждрзБржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржиред
2. **POST /login**: рж▓ржЧржЗржи ржПржмржВ ржЯрзЛржХрзЗржи ржкрж╛ржУрзЯрж╛рж░ ржЬржирзНржпред
3. **GET /protected**: рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ ржЬржирзНржпред (ржЯрзЛржХрзЗржи рж╕рж╣ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ)
4. **POST /logout**: рж▓ржЧржЖржЙржЯ ржПржмржВ ржЯрзЛржХрзЗржи ржорзБржЫрзЗ ржлрзЗрж▓рж╛ред

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **Auth System рж╕ржорзНржкрзВрж░рзНржг ржХрж░рж╛**: рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи, рж▓ржЧржЗржи, рж▓ржЧржЖржЙржЯ ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯржЧрзБрж▓рж┐рж░ рж╕ржм ржлрж┐ржЪрж╛рж░ ржмрж╛рж╕рзНрждржмрж╛рзЯржи ржХрж░рж╛ред
- **Token Verification Middleware**: HTTP-only cookie ржерзЗржХрзЗ ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ ржПржмржВ рж╕рзБрж░ржХрзНрж╖рж┐ржд рж░рж╛ржЙржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржжрзЗрзЯрж╛ред
- **Testing**: Postman ржмрж╛ Insomnia ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Auth System ржЯрзЗрж╕рзНржЯрж┐ржВред

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж╛рж░ Auth System ржкрзНрж░рж╕рзНрждрзБржд ржПржмржВ рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЯрзЗрж╕рзНржЯ ржХрж░рж╛ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ! ЁЯЪА





