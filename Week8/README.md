# Day 50

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: One-to-many with ObjectId**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ **One-to-Many relationship** рждрзИрж░рж┐ ржХрж░ржмрзЛ, ржпрзЗржЦрж╛ржирзЗ ржПржХржЯрж┐ ржбржХрзБржорзЗржирзНржЯрзЗрж░ ржоржзрзНржпрзЗ ржЕржирзЗржХржЧрзБрж▓рж┐ рж╕рж╛ржм-ржбржХрзБржорзЗржирзНржЯ рж╕ржорзНржкрж░рзНржХрж┐ржд ржерж╛ржХржмрзЗред ржПржЯрж┐ рж╕рж╛ржзрж╛рж░ржгржд **ObjectId** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ MongoDB-рждрзЗ ржХрж╛рж░рзНржпржХрж░ ржХрж░рж╛ рж╣рзЯред 

---

## тП╕я╕П 1. What is One-to-Many Relationship?

ржПржХржЯрж┐ **One-to-Many** рж╕ржорзНржкрж░рзНржХрзЗрж░ ржоржзрзНржпрзЗ, ржПржХржЯрж┐ ржПржХржХ ржбржХрзБржорзЗржирзНржЯ ржЕржирзНржп ржЕржирзЗржХ ржбржХрзБржорзЗржирзНржЯрзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржерж╛ржХрзЗред ржЙржжрж╛рж╣рж░ржгрж╕рзНржмрж░рзВржк, ржПржХржЯрж┐ **Author** ржоржбрзЗрж▓ рж╣рждрзЗ ржкрж╛рж░рзЗ ржпрж╛рж░ ржЕржирзЗржХржЧрзБрж▓рж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ ржерж╛ржХржмрзЗред ржПржЦрж╛ржирзЗ **Author** ржоржбрзЗрж▓ржЯрж┐ **Blog** ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржерж╛ржХрзЗ, ржпрзЗржЦрж╛ржирзЗ ржПржХржЯрж┐ **Author** ржПрж░ ржЬржирзНржп ржЕржирзЗржХ **Blog** ржкрзЛрж╖рзНржЯ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред

---

## тП╕я╕П 2. Set up Mongoose Models

### Author Model

ржкрзНрж░ржержорзЗ **Author** ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ, ржпрзЗржЦрж╛ржирзЗ рж▓рзЗржЦржХрзЗрж░ ржирж╛ржо ржПржмржВ ржЗржорзЗржЗрж▓ ржерж╛ржХржмрзЗред

```js
const mongoose = require('mongoose');

const authorSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true
  },
  email: {
    type: String,
    required: true,
    unique: true
  }
});

const Author = mongoose.model('Author', authorSchema);
module.exports = Author;
```

ржПржЦрж╛ржирзЗ:
- **Author** ржоржбрзЗрж▓ржЯрж┐ рж▓рзЗржЦржХрзЗрж░ ржирж╛ржо ржПржмржВ ржЗржорзЗржЗрж▓ ржзрж╛рж░ржг ржХрж░рзЗред

### Blog Model

ржПржЦржи **Blog** ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ, ржпрзЗржЦрж╛ржирзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╢рж┐рж░рзЛржирж╛ржо, ржХржиржЯрзЗржирзНржЯ ржПржмржВ рж▓рзЗржЦржХ (author) рж╕ржорзНржкрж░рзНржХрж┐ржд ObjectId ржерж╛ржХржмрзЗред

```js
const mongoose = require('mongoose');

const blogSchema = new mongoose.Schema({
  title: {
    type: String,
    required: true
  },
  content: {
    type: String,
    required: true
  },
  createdAt: {
    type: Date,
    default: Date.now
  },
  author: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Author',
    required: true
  }
});

const Blog = mongoose.model('Blog', blogSchema);
module.exports = Blog;
```

ржПржЦрж╛ржирзЗ:
- **author** ржлрж┐рж▓рзНржбржЯрж┐ **Author** ржоржбрзЗрж▓рзЗрж░ **ObjectId** рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗред ржПржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╕рж╛ржерзЗ рж▓рзЗржЦржХрзЗрж░ рж╕ржорзНржкрж░рзНржХ рждрзИрж░рж┐ ржХрж░рзЗред

---

## тП╕я╕П 3. Create API to Add Blog for an Author

ржПржЦржи, ржЖржорж╛ржжрзЗрж░ ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ ржПржХржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ рждрзИрж░рж┐ ржХрж░ржмрзЗ ржПржмржВ рж▓рзЗржЦржХ (author) рж╕ржорзНржкрж░рзНржХрж┐ржд рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржмрзЗред

### Example: Add Blog with Author Reference

```js
const express = require('express');
const mongoose = require('mongoose');
const Author = require('./models/Author');
const Blog = require('./models/Blog');
const app = express();
const port = 3000;

mongoose.connect('mongodb://localhost:27017/blogAPI', { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.log(err));

app.use(express.json());

// Add Blog Post for an Author
app.post('/blogs', async (req, res) => {
  try {
    const { title, content, authorId } = req.body;

    // Check if the author exists
    const author = await Author.findById(authorId);
    if (!author) {
      return res.status(404).json({ message: 'Author not found' });
    }

    // Create a new blog post with the author reference
    const newBlog = new Blog({
      title,
      content,
      author: authorId
    });

    // Save the new blog post
    await newBlog.save();
    res.status(201).json(newBlog);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

ржПржЦрж╛ржирзЗ:
- **POST `/blogs`** API ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЖржорж░рж╛ ржПржХржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рж┐, ржпрзЗржЦрж╛ржирзЗ рж▓рзЗржЦржХ (author) ржПрж░ **ObjectId** ржкрзНрж░рзЗрж░рж┐ржд рж╣рзЯред

---

## тП╕я╕П 4. Get Blogs for an Author (One-to-Many)

ржПржЦржи, ржЖржорж░рж╛ ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрж╛ ржПржХржЯрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж▓рзЗржЦржХрзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд рж╕ржорж╕рзНржд ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░ржмрзЗред ржПржЯрж┐ **One-to-Many** рж╕ржорзНржкрж░рзНржХрзЗрж░ ржмрж╛рж╕рзНрждржмрж╛рзЯржиред

### Example: Get Blogs by Author

```js
// Get all blogs by a specific author
app.get('/authors/:authorId/blogs', async (req, res) => {
  try {
    const blogs = await Blog.find({ author: req.params.authorId }).populate('author');
    if (blogs.length === 0) {
      return res.status(404).json({ message: 'No blogs found for this author' });
    }
    res.json(blogs);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});
```

ржПржЦрж╛ржирзЗ:
- **GET `/authors/:authorId/blogs`** API рж▓рзЗржЦржХрзЗрж░ **`authorId`** ржжрзНржмрж╛рж░рж╛ рж╕ржорзНржкрж░рзНржХрж┐ржд рж╕ржорж╕рзНржд ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ ржлрзЗрж░ржд ржжрзЗрзЯред
- **`populate('author')`** ржмрзНржпржмрж╣рзГржд рж╣рзЯрзЗржЫрзЗ ржпрж╛рждрзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж▓рзЗржЦржХрзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржпржУ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ред

---

## тП╕я╕П 5. Testing the One-to-Many API

ржПржЦржи, ржЖржорж╛ржжрзЗрж░ рждрзИрж░рж┐ API ржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛рж░ ржЬржирзНржп **Postman** ржЕржержмрж╛ **Insomnia** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред

1. **POST `/blogs`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи ржПржХржЯрж┐ ржирждрзБржи ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ:
   - **Request Body:**
     ```json
     {
       "title": "My Second Blog Post",
       "content": "Content for the second blog post.",
       "authorId": "authorObjectIdHere"
     }
     ```

2. **GET `/authors/:authorId/blogs`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи рж▓рзЗржЦржХрзЗрж░ рж╕ржорж╕рзНржд ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ ржкрзЗрждрзЗ:
   - **Response:**
     ```json
     [
       {
         "title": "My Second Blog Post",
         "content": "Content for the second blog post.",
         "author": {
           "_id": "authorObjectIdHere",
           "name": "Author Name",
           "email": "author@example.com"
         }
       }
     ]
     ```

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **One-to-Many relationship** ржХрж┐ржнрж╛ржмрзЗ **MongoDB** ржПржмржВ **Mongoose** ржПрж░ ржорж╛ржзрзНржпржорзЗ ржХрж╛рж░рзНржпржХрж░ ржХрж░рж╛ ржпрж╛рзЯред
- **ObjectId** рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ **Blog** ржоржбрзЗрж▓рзЗ **Author** ржоржбрзЗрж▓рзЗрж░ рждржерзНржп рж╕ржВржпрзБржХрзНржд ржХрж░рж╛ рж╣рзЯред
- **populate()** ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржбрзЗржЯрж╛ ржПржХрждрзНрж░рзЗ ржлрзЗрж░ржд ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи ржХрж┐ржнрж╛ржмрзЗ **One-to-Many relationship** ржмрж╛рж╕рзНрждржмрж╛рзЯржи ржХрж░ржмрзЗржи ржПржмржВ MongoDB-рждрзЗ ржПржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░ржмрзЗржиред ЁЯОЙЁЯЪА





# Day 51

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Populate Comments Inside Post**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ ржоржзрзНржпрзЗ **Comments** ржкржкрзБрж▓рзЗржЯ ржХрж░рждрзЗ рж╣рзЯред ржПржЯрж┐ **One-to-Many** рж╕ржорзНржкрж░рзНржХрзЗрж░ ржПржХржЯрж┐ ржЙржирзНржиржд ржмрзНржпржмрж╣рж╛рж░, ржпрзЗржЦрж╛ржирзЗ ржПржХржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗ ржПржХрж╛ржзрж┐ржХ ржоржирзНрждржмрзНржп (comments) ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржЖржорж░рж╛ ржПржЗ рж╕ржорзНржкрж░рзНржХржЯрж┐ **Mongoose** ржПрж░ ржорж╛ржзрзНржпржорзЗ ржмрж╛рж╕рзНрждржмрж╛рзЯржи ржХрж░ржмрзЛ ржПржмржВ **populate()** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржоржирзНрждржмрзНржпржЧрзБрж▓рж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ ржоржзрзНржпрзЗ ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржХрж░ржмрзЛред

---

## тП╕я╕П 1. What is Populate Comments Inside Post?

ржпржЦржи ржПржХржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗ ржоржирзНрждржмрзНржп ржерж╛ржХрзЗ, рждржЦржи ржкрзНрж░рждрж┐ржЯрж┐ ржоржирзНрждржмрзНржпрзЗрж░ рждржерзНржп **Post** ржоржбрзЗрж▓рзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржерж╛ржХрзЗред ржЖржорж░рж╛ **populate()** ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╕рж╛ржерзЗ ржоржирзНрждржмрзНржпржЧрзБрж▓рзЛржХрзЗ ржПржХрждрзНрж░рзЗ ржирж┐рзЯрзЗ ржЖрж╕рждрзЗ ржкрж╛рж░рж┐ред ржПржЗ рж╕ржорзНржкрж░рзНржХржЯрж┐ ржПржХржжрж┐ржХрзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ ржПржмржВ ржЕржирзНржпржжрж┐ржХрзЗ ржоржирзНрждржмрзНржп (comments) ржПрж░ ржоржзрзНржпрзЗ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ, ржпрзЗржЦрж╛ржирзЗ ржПржХ ржкрзЛрж╕рзНржЯрзЗ ржЕржирзЗржХ ржоржирзНрждржмрзНржп ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред

---

## тП╕я╕П 2. Set up Mongoose Models

ржЖржорж╛ржжрзЗрж░ ржжрзБржЗржЯрж┐ ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ:
1. **Post** - ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ ржЬржирзНржп
2. **Comment** - ржоржирзНрждржмрзНржпрзЗрж░ ржЬржирзНржп

### Post Model

ржкрзНрж░ржержорзЗ **Post** ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛ржХ, ржпрзЗржЦрж╛ржирзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╢рж┐рж░рзЛржирж╛ржо, ржХржиржЯрзЗржирзНржЯ ржПржмржВ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржп (comments) ржерж╛ржХржмрзЗред

```js
const mongoose = require('mongoose');

const postSchema = new mongoose.Schema({
  title: {
    type: String,
    required: true
  },
  content: {
    type: String,
    required: true
  },
  createdAt: {
    type: Date,
    default: Date.now
  },
  comments: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Comment'
  }]
});

const Post = mongoose.model('Post', postSchema);
module.exports = Post;
```

ржПржЦрж╛ржирзЗ:
- **comments** ржлрж┐рж▓рзНржбржЯрж┐ ржПржХржЯрж┐ ржЕрзНржпрж╛рж░рзЗ, ржпрзЗржЦрж╛ржирзЗ **Comment** ржоржбрзЗрж▓рзЗрж░ **ObjectId** рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржерж╛ржХржмрзЗред

### Comment Model

ржПржЦржи **Comment** ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░рж╛ ржпрж╛ржХ, ржпрзЗржЦрж╛ржирзЗ ржоржирзНрждржмрзНржпрзЗрж░ ржХржиржЯрзЗржирзНржЯ ржПржмржВ рж▓рзЗржЦржХ (author) ржерж╛ржХржмрзЗред

```js
const mongoose = require('mongoose');

const commentSchema = new mongoose.Schema({
  content: {
    type: String,
    required: true
  },
  author: {
    type: String,
    required: true
  },
  createdAt: {
    type: Date,
    default: Date.now
  }
});

const Comment = mongoose.model('Comment', commentSchema);
module.exports = Comment;
```

ржПржЦрж╛ржирзЗ:
- **Comment** ржоржбрзЗрж▓ржЯрж┐ ржПржХржЯрж┐ ржоржирзНрждржмрзНржпрзЗрж░ ржХржиржЯрзЗржирзНржЯ ржПржмржВ рж▓рзЗржЦржХ ржзрж╛рж░ржг ржХрж░рзЗред

---

## тП╕я╕П 3. Add Comments to a Post

ржПржЦржи, ржЖржорж╛ржжрзЗрж░ ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗ ржоржирзНрждржмрзНржп ржпрзЛржЧ ржХрж░ржмрзЗред ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗ ржоржирзНрждржмрзНржп рж╕ржВржпрзБржХрзНржд ржХрж░рждрзЗ рж╣ржмрзЗ ржПржмржВ рж╕рзЗржЗ ржоржирзНрждржмрзНржпрзЗрж░ **ObjectId** ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ **comments** ржЕрзНржпрж╛рж░рзЗрждрзЗ рж░рж╛ржЦрж╛ рж╣ржмрзЗред

### Example: Add Comment to Post

```js
const express = require('express');
const mongoose = require('mongoose');
const Post = require('./models/Post');
const Comment = require('./models/Comment');
const app = express();
const port = 3000;

mongoose.connect('mongodb://localhost:27017/blogAPI', { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.log(err));

app.use(express.json());

// Add Comment to a Post
app.post('/posts/:postId/comments', async (req, res) => {
  try {
    const { content, author } = req.body;
    const postId = req.params.postId;

    // Find the post to add the comment to
    const post = await Post.findById(postId);
    if (!post) {
      return res.status(404).json({ message: 'Post not found' });
    }

    // Create a new comment
    const newComment = new Comment({
      content,
      author
    });

    // Save the new comment
    await newComment.save();

    // Add the comment's ObjectId to the post's comments array
    post.comments.push(newComment._id);
    await post.save();

    res.status(201).json(newComment);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

ржПржЦрж╛ржирзЗ:
- **POST `/posts/:postId/comments`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ ржПржХржЯрж┐ ржирждрзБржи ржоржирзНрждржмрзНржп рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯ ржПржмржВ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ **comments** ржЕрзНржпрж╛рж░рзЗрждрзЗ **ObjectId** ржпрзБржХрзНржд ржХрж░рж╛ рж╣рзЯред

---

## тП╕я╕П 4. Populate Comments Inside Post

ржПржЦржи, ржЖржорж╛ржжрзЗрж░ ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржпржЧрзБрж▓рзЛ ржкржкрзБрж▓рзЗржЯ ржХрж░рзЗ ржжрзЗржЦрж╛ржмрзЗред

### Example: Get Post with Populated Comments

```js
// Get post with populated comments
app.get('/posts/:postId', async (req, res) => {
  try {
    const post = await Post.findById(req.params.postId).populate('comments');
    if (!post) {
      return res.status(404).json({ message: 'Post not found' });
    }
    res.json(post);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});
```

ржПржЦрж╛ржирзЗ:
- **GET `/posts/:postId`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рждржерзНржп ржПржмржВ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржпржЧрзБрж▓рзЛ **populate()** ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрждрзНрж░рзЗ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗред

---

## тП╕я╕П 5. Testing the Populate Comments API

ржПржЦржи, ржЖржорж╛ржжрзЗрж░ рждрзИрж░рж┐ API ржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛рж░ ржЬржирзНржп **Postman** ржЕржержмрж╛ **Insomnia** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржмрзЗред

1. **POST `/posts/:postId/comments`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи ржПржХржЯрж┐ ржирждрзБржи ржоржирзНрждржмрзНржп рждрзИрж░рж┐ ржХрж░рждрзЗ:
   - **Request Body:**
     ```json
     {
       "content": "This is a comment on the post.",
       "author": "Author Name"
     }
     ```

2. **GET `/posts/:postId`** рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯ рж╕рж╣ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржпржЧрзБрж▓рж┐ ржкрзЗрждрзЗ:
   - **Response:**
     ```json
     {
       "title": "My Blog Post",
       "content": "Content for the blog post.",
       "comments": [
         {
           "_id": "commentObjectIdHere",
           "content": "This is a comment on the post.",
           "author": "Author Name",
           "createdAt": "2025-04-10T12:00:00Z"
         }
       ]
     }
     ```

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **Populate()** ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ ржоржзрзНржпрзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржпржЧрзБрж▓рж┐ ржкржкрзБрж▓рзЗржЯ ржХрж░рждрзЗред
- ржХрж┐ржнрж╛ржмрзЗ **One-to-Many** рж╕ржорзНржкрж░рзНржХ рждрзИрж░рж┐ ржХрж░рзЗ ржПржХржЯрж┐ ржкрзЛрж╕рзНржЯрзЗ ржоржирзНрждржмрзНржп ржпрзБржХрзНржд ржХрж░рждрзЗ рж╣рзЯред
- ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржоржирзНрждржмрзНржпржЧрзБрж▓рж┐ ржПржХрждрзНрж░рзЗ ржкрзНрж░рж╛ржкрзНржд ржХрж░рждрзЗ API рждрзИрж░рж┐ ржХрж░рж╛ред

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи ржХрж┐ржнрж╛ржмрзЗ **populate()** ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ MongoDB рждрзЗ ржмрзНрж▓ржЧ ржкрзЛрж╖рзНржЯрзЗрж░ ржоржирзНрждржмрзНржпржЧрзБрж▓рж┐ ржкржкрзБрж▓рзЗржЯ ржХрж░ржмрзЗржиред ЁЯОЙЁЯЪА





# Day 52

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Start MongoDB Transaction**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ **MongoDB** рждрзЗ **transactions** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржпрж╛рзЯред **MongoDB transactions** ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржиржХрзЗ ржПржХрждрзНрж░рзЗ ржХрж╛рж░рзНржпржХрж░ ржХрж░рждрзЗ рж╕ржХрзНрж╖ржо рж╣рзЯ, ржпрж╛ ржПржХржХ ржЗржЙржирж┐ржЯ рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред ржЕрж░рзНржерж╛рзО, ржпржжрж┐ ржХрзЛржиржУ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯ, ржлрж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржЕрж░рзНржзрзЗржХ ржЖржкржбрзЗржЯрзЗрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ рж╕ржорзНржкрзВрж░рзНржг рж░рзЛрж▓ржмрзНржпрж╛ржХ рж╣ржмрзЗред

---

## тП╕я╕П 1. What is MongoDB Transaction?

MongoDB рждрзЗ **transaction** ржПржХржЯрж┐ ржмрж╛ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи (ржпрзЗржоржи, insert, update, delete) ржПржХрждрзНрж░рзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛рж░ ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛ред ржпржжрж┐ ржХрзЛржиржУ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯ, ржпрзЗржи ржбрж╛ржЯрж╛ржмрзЗржЬрзЗрж░ ржЕржмрж╕рзНржерж╛ржи ржЕржкрж░рж┐ржмрж░рзНрждрж┐ржд ржерж╛ржХрзЗред

MongoDB рждрзЗ transaction ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ, **session** ржПржмржВ **transaction** ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ рж╣рзЯред ржПржЯрж┐ **ACID** (Atomicity, Consistency, Isolation, Durability) ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗред

---

## тП╕я╕П 2. Setup MongoDB Connection with Transactions

MongoDB рждрзЗ transaction ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛рж░ ржЬржирзНржп ржкрзНрж░ржержорзЗ **MongoDB Atlas** ржЕржержмрж╛ рж▓рзЛржХрж╛рж▓ MongoDB ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж╕ржВржпрзЛржЧ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ **Mongoose** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ MongoDB рждрзЗ рж╕ржВржпрзЛржЧ ржПржмржВ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзБрж░рзБ ржХрж░ржмрзЛред

### MongoDB Connection Setup

```js
const mongoose = require('mongoose');

mongoose.connect('mongodb://localhost:27017/yourDatabase', {
  useNewUrlParser: true,
  useUnifiedTopology: true,
})
  .then(() => console.log('MongoDB connected'))
  .catch((err) => console.log(err));
```

ржПржЦрж╛ржирзЗ, ржЖржорж░рж╛ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░рзЗржЫрж┐ред рж╕ржВржпрзЛржЧ рж╕ржлрж▓ рж╣рж▓рзЗ **MongoDB connected** ржорзНржпрж╛рж╕рзЗржЬ ржжрзЗржЦрж╛ржирзЛ рж╣ржмрзЗред

---

## тП╕я╕П 3. Create Models for Transactions

ржЖржЬржХрзЗрж░ ржЙржжрж╛рж╣рж░ржгрзЗ ржЖржорж░рж╛ ржжрзБржЯрж┐ ржоржбрзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛ: **User** ржПржмржВ **Order**ред ржПржХржЯрж┐ **User** ржоржбрзЗрж▓ ржерж╛ржХржмрзЗ ржПржмржВ ржПржХржЯрж┐ **Order** ржоржбрзЗрж▓ ржерж╛ржХржмрзЗ ржпрзЗржЦрж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржПржХржЯрж┐ ржкржгрзНржп ржЕрж░рзНржбрж╛рж░ ржХрж░ржмрзЗред ржЖржорж░рж╛ ржжрзЗржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ ржПржХржпрзЛржЧрзЗ **User** ржПржмржВ **Order** ржоржбрзЗрж▓рзЗрж░ ржЕржкрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛рзЯ MongoDB transaction ржПрж░ ржорж╛ржзрзНржпржорзЗред

### User Model

```js
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  name: String,
  balance: {
    type: Number,
    default: 0,
  },
});

const User = mongoose.model('User', userSchema);
module.exports = User;
```

### Order Model

```js
const mongoose = require('mongoose');

const orderSchema = new mongoose.Schema({
  product: String,
  price: Number,
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
  },
});

const Order = mongoose.model('Order', orderSchema);
module.exports = Order;
```

ржПржЦрж╛ржирзЗ:
- **User** ржоржбрзЗрж▓ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржирж╛ржо ржПржмржВ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржзрж╛рж░ржг ржХрж░рзЗред
- **Order** ржоржбрзЗрж▓ржЯрж┐ ржкржгрзНржп ржПржмржВ рждрж╛рж░ ржорзВрж▓рзНржпрж╕рж╣ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд ржерж╛ржХрзЗред

---

## тП╕я╕П 4. Start MongoDB Transaction

ржПржЦржи ржЖржорж░рж╛ **MongoDB Transaction** рж╢рзБрж░рзБ ржХрж░ржмрзЛред ржПржХрж╛ржзрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрж╕рж╛ржерзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржирзЗрж░ ржоржзрзНржпрзЗ ржХрж░рж╛ рж╣ржмрзЗ: 
1. ржПржХржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржерзЗржХрзЗ ржЯрж╛ржХрж╛ ржХржорж╛ржирзЛред
2. ржПржХржЯрж┐ ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ред

### Example: MongoDB Transaction for User Order

```js
const express = require('express');
const mongoose = require('mongoose');
const User = require('./models/User');
const Order = require('./models/Order');
const app = express();
const port = 3000;

app.use(express.json());

app.post('/order', async (req, res) => {
  const session = await mongoose.startSession();
  session.startTransaction();
  
  try {
    const { userId, product, price } = req.body;

    // Find user and check balance
    const user = await User.findById(userId).session(session);
    if (!user) {
      throw new Error('User not found');
    }
    if (user.balance < price) {
      throw new Error('Insufficient balance');
    }

    // Deduct balance from the user
    user.balance -= price;
    await user.save();

    // Create order
    const newOrder = new Order({
      product,
      price,
      userId: user._id,
    });
    await newOrder.save();

    // Commit transaction
    await session.commitTransaction();
    res.status(201).json({ message: 'Order placed successfully', order: newOrder });
  } catch (error) {
    // If any error occurs, rollback transaction
    await session.abortTransaction();
    res.status(500).json({ error: error.message });
  } finally {
    session.endSession();
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

### Explanation:

1. **Start Session:** ржкрзНрж░ржержорзЗ `startSession()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ рж╕рзЗрж╢ржи рж╢рзБрж░рзБ рж╣рзЯред ржПрж░ржкрж░ рж╕рзЗрж╢ржиржЯрж┐ржХрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзБрж░рзБ ржХрж░рждрзЗ `startTransaction()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред
   
2. **Perform Operations:** 
   - ржкрзНрж░ржержорзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржЪрзЗржХ ржХрж░рж╛ рж╣рзЯред ржпржжрж┐ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржХржо ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ **Insufficient balance** ржПрж░рж░ ржжрзЗржЦрж╛ржирзЛ рж╣рзЯред
   - ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржерзЗржХрзЗ ржорзВрж▓рзНржп ржХржорж╛ржирзЛ рж╣рзЯ ржПржмржВ рждрж╛рж░ржкрж░ ржПржХржЯрж┐ ржирждрзБржи ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯред
   
3. **Commit or Abort Transaction:**
   - ржпржжрж┐ рж╕ржм ржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ `commitTransaction()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржХржорж┐ржЯ ржХрж░рж╛ рж╣рзЯред
   - ржпржжрж┐ ржХрзЛржирзЛ ржнрзБрж▓ ржШржЯрзЗ, рждрж╛рж╣рж▓рзЗ `abortTransaction()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯред

4. **End Session:** ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзЗрж╖рзЗ рж╕рзЗрж╢ржиржЯрж┐ рж╢рзЗрж╖ ржХрж░рж╛ рж╣рзЯред

---

## тП╕я╕П 5. Testing the MongoDB Transaction

ржПржЦржи, ржЖржорж░рж╛ ржПржЗ API ржЯрж┐рж░ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ **Postman** ржЕржержмрж╛ **Insomnia** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

### Example Request:

**POST `/order`**

Request Body:
```json
{
  "userId": "userObjectIdHere",
  "product": "Laptop",
  "price": 500
}
```

Response:
```json
{
  "message": "Order placed successfully",
  "order": {
    "_id": "orderObjectIdHere",
    "product": "Laptop",
    "price": 500,
    "userId": "userObjectIdHere"
  }
}
```

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- ржХрж┐ржнрж╛ржмрзЗ **MongoDB Transaction** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрждрзНрж░рзЗ ржХрж░рж╛ ржпрж╛рзЯред
- ржХрж┐ржнрж╛ржмрзЗ **session** ржПржмржВ **transaction** ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ACID ржХржоржкрзНрж▓рж╛рзЯрзЗржирзНрж╕ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ рж╣рзЯред
- **commitTransaction()** ржПржмржВ **abortTransaction()** ржПрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржПржмржВ рж╕ржлрж▓рждрж╛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ рж╣рзЯред

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ **transactions** ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗрж░ ржмрж┐ржнрж┐ржирзНржи ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржпрзЛржЧрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛рзЯред ЁЯОЙЁЯЪА






# Day 53

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Implement rollback using `abortTransaction()`**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░рзЗрж░ рж╕ржорзЯ **rollback** ржХрж░рж╛ ржпрж╛рзЯ `abortTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред MongoDB рждрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЖржорж░рж╛ ржПржХрж╛ржзрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрж╕рж╛ржерзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рж┐, ржПржмржВ ржпржжрж┐ ржХрзЛржиржУ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждржмрзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯред 

`abortTransaction()` ржорзЗржержб MongoDB рждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛рж░ ржЬржирзНржп, ржпрж╛рждрзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржХрзЛржиржУ ржЕржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ ржШржЯрзЗред

---

## тП╕я╕П 1. What is Rollback in MongoDB?

MongoDB рждрзЗ **rollback** рж╣рж▓ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржпрж╛ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗрж░ ржЖржЧрзЗрж░ ржЕржмрж╕рзНржерж╛ ржлрж┐рж░рзЗ ржирж┐рзЯрзЗ ржЖрж╕рзЗред ржПржЯрж┐ рждржЦржи ржкрзНрж░рзЯрзЛржЬржи рж╣рзЯ ржпржЦржи ржХрзЛржи ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржпрзЛржЧрзЗ рж╕ржорзНржкрж╛ржжржи ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ ржПржмржВ ржпржжрж┐ ржХрзЛржи ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржкрзБрж░рзЛ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯред ржПрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржЕржпрж╛ржЪрж┐ржд ржкрж░рж┐ржмрж░рзНрждржи ржерзЗржХрзЗ рж░ржХрзНрж╖рж╛ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

---

## тП╕я╕П 2. Setup MongoDB Connection with Mongoose

ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ MongoDB ржПрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░ржмрзЛ ржПржмржВ `startSession()` ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзБрж░рзБ ржХрж░ржмрзЛред

### MongoDB Connection Setup

```js
const mongoose = require('mongoose');

mongoose.connect('mongodb://localhost:27017/yourDatabase', {
  useNewUrlParser: true,
  useUnifiedTopology: true,
})
  .then(() => console.log('MongoDB connected'))
  .catch((err) => console.log(err));
```

ржПржЦрж╛ржирзЗ, ржЖржорж░рж╛ MongoDB ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж╕ржВржпрзЛржЧ рж╕рзНржерж╛ржкржи ржХрж░ржЫрж┐ред

---

## тП╕я╕П 3. Create Models for Transaction Example

ржЖржорж░рж╛ ржжрзБржЯрж┐ ржоржбрзЗрж▓ рждрзИрж░рж┐ ржХрж░ржмрзЛ: **User** ржПржмржВ **Order**ред ржПржЦрж╛ржирзЗ **User** ржоржбрзЗрж▓ржЯрж┐ ржПржХржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ рждржерзНржп ржзрж╛рж░ржг ржХрж░ржмрзЗ ржПржмржВ **Order** ржоржбрзЗрж▓ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЕрж░рзНржбрж╛рж░ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржмрзЗред

### User Model

```js
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  name: String,
  balance: {
    type: Number,
    default: 0,
  },
});

const User = mongoose.model('User', userSchema);
module.exports = User;
```

### Order Model

```js
const mongoose = require('mongoose');

const orderSchema = new mongoose.Schema({
  product: String,
  price: Number,
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
  },
});

const Order = mongoose.model('Order', orderSchema);
module.exports = Order;
```

ржПржЦрж╛ржирзЗ:
- **User** ржоржбрзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рждржерзНржп ржзрж╛рж░ржг ржХрж░рзЗ, ржпрзЗржоржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕ред
- **Order** ржоржбрзЗрж▓ ржЕрж░рзНржбрж╛рж░ рж╕ржорзНржкрж░рзНржХрж┐ржд рждржерзНржп ржзрж╛рж░ржг ржХрж░рзЗ, ржпрзЗржоржи ржкржгрзНржпрзЗрж░ ржирж╛ржо ржПржмржВ ржорзВрж▓рзНржпред

---

## тП╕я╕П 4. Implementing `abortTransaction()` for Rollback

ржПржЦржи ржЖржорж░рж╛ MongoDB рждрзЗ **rollback** ржкрзНрж░рзЯрзЛржЧ ржХрж░ржмрзЛред ржпржжрж┐ ржХрзЛржи ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ `abortTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣ржмрзЗред

### Example: Rollback with `abortTransaction()`

```js
const express = require('express');
const mongoose = require('mongoose');
const User = require('./models/User');
const Order = require('./models/Order');
const app = express();
const port = 3000;

app.use(express.json());

app.post('/order', async (req, res) => {
  const session = await mongoose.startSession();
  session.startTransaction();
  
  try {
    const { userId, product, price } = req.body;

    // Find user and check balance
    const user = await User.findById(userId).session(session);
    if (!user) {
      throw new Error('User not found');
    }
    if (user.balance < price) {
      throw new Error('Insufficient balance');
    }

    // Deduct balance from the user
    user.balance -= price;
    await user.save();

    // Create order
    const newOrder = new Order({
      product,
      price,
      userId: user._id,
    });
    await newOrder.save();

    // Commit transaction
    await session.commitTransaction();
    res.status(201).json({ message: 'Order placed successfully', order: newOrder });
  } catch (error) {
    // If any error occurs, rollback transaction
    await session.abortTransaction();
    res.status(500).json({ error: error.message });
  } finally {
    session.endSession();
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

### Explanation:

1. **Start Session and Transaction:** 
   - ржкрзНрж░ржержорзЗ, ржЖржорж░рж╛ `startSession()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ рж╕рзЗрж╢ржи рж╢рзБрж░рзБ ржХрж░рж┐ ржПржмржВ ржкрж░рзЗ `startTransaction()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзБрж░рзБ ржХрж░рж┐ред

2. **Perform Operations:** 
   - **User Balance Check:** ржкрзНрж░ржержорзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржЪрзЗржХ ржХрж░рж╛ рж╣рзЯред ржпржжрж┐ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржХржо рж╣рзЯ, рждрж╛рж╣рж▓рзЗ **Insufficient balance** ржПрж░рж░ ржжрзЗржЦрж╛ржирзЛ рж╣рзЯред
   - **Deduct User Balance:** ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржерзЗржХрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржкрж░рж┐ржорж╛ржг ржЯрж╛ржХрж╛ ржХржорж╛ржирзЛ рж╣рзЯред
   - **Create Order:** рждрж╛рж░ржкрж░ ржПржХржЯрж┐ ржирждрзБржи ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯред

3. **Commit or Abort Transaction:** 
   - ржпржжрж┐ рж╕ржорж╕рзНржд ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржарж┐ржХржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи рж╣рзЯ, рждрж╛рж╣рж▓рзЗ `commitTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи ржХрж░рж╛ рж╣рзЯред
   - ржпржжрж┐ ржХрзЛржи ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ `abortTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржХрж░рж╛ рж╣рзЯ, ржЕрж░рзНржерж╛рзО ржкрзВрж░рзНржмрзЗрж░ ржЕржмрж╕рзНржерж╛ ржлрж┐рж░рзЗ ржЖрж╕рзЗред

4. **End Session:** 
   - рж╕рзЗрж╢ржи рж╢рзЗрж╖рзЗ, `endSession()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзЗрж╢ржиржЯрж┐ рж╢рзЗрж╖ ржХрж░рж╛ рж╣рзЯред

---

## тП╕я╕П 5. Testing the Rollback

ржПржЦржи, ржЖржорж░рж╛ ржПржЗ API ржЯрж┐рж░ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ **Postman** ржмрж╛ **Insomnia** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

### Example Request:

**POST `/order`**

Request Body:
```json
{
  "userId": "userObjectIdHere",
  "product": "Laptop",
  "price": 500
}
```

Response:
```json
{
  "message": "Order placed successfully",
  "order": {
    "_id": "orderObjectIdHere",
    "product": "Laptop",
    "price": 500,
    "userId": "userObjectIdHere"
  }
}
```

ржПржЫрж╛рзЬрж╛, ржпржжрж┐ ржХрзЛржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗрж░ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, рждржЦржи:
```json
{
  "error": "Insufficient balance"
}
```

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ **rollback** ржкрзНрж░рзЯрзЛржЧ ржХрж░рж╛ рж╣рзЯ `abortTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред
- ржХрж┐ржнрж╛ржмрзЗ ржПржХрж╛ржзрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржпрзЛржЧрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛рзЯ MongoDB рждрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред
- ржХрж┐ржнрж╛ржмрзЗ **transaction commit** ржПржмржВ **rollback** ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ рж╣рзЯ рж╕ржлрж▓ ржПржмржВ ржмрзНржпрж░рзНрже ржЕржкрж╛рж░рзЗрж╢ржирзЗрж░ ржХрзНрж╖рзЗрждрзНрж░рзЗред

ржПржЯрж┐ MongoDB ржПрж░ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░рзЗрж░ рж╕ржорзЯ рж░рзЛрж▓ржмрзНржпрж╛ржХ ржкрзНрж░рзЯрзЛржЧ ржХрж░рж╛рж░ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЕржВрж╢ ржЫрж┐рж▓ред ЁЯОЙЁЯЪА





# Day 54

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Soft delete using flags**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ **Soft Delete** ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛рзЯ MongoDB рждрзЗред рж╕рж╛ржзрж╛рж░ржгржд **soft delete** ржПржоржи ржПржХржЯрж┐ ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛, ржпрзЗржЦрж╛ржирзЗ ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ ржХрж░рж╛ рж╣рзЯ ржирж╛, ржмрж░ржВ ржбрж╛ржЯрж╛рж░ ржПржХржЯрж┐ ржлрзНрж▓рзНржпрж╛ржЧ рж╕рзЗржЯ ржХрж░рж╛ рж╣рзЯ, ржпрж╛ рж╕рзЗржЗ рж░рзЗржХрж░рзНржбржЯрж┐ ржбрж┐рж▓рж┐ржЯ рж╣рзЯрзЗржЫрзЗ ржмрж▓рзЗ ржЪрж┐рж╣рзНржирж┐ржд ржХрж░рзЗред ржПрж░ ржорж╛ржзрзНржпржорзЗ, ржбрж╛ржЯрж╛ рж╕рж╣ржЬрзЗ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рж╛ ржпрж╛рзЯ ржПржмржВ ржЗрждрж┐рж╣рж╛рж╕ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ рж╕ржорзНржнржм рж╣рзЯред

---

## тП╕я╕П 1. What is Soft Delete?

**Soft Delete** рж╣рж▓ ржПржоржи ржПржХржЯрж┐ ржкржжрзНржзрждрж┐ ржпрзЗржЦрж╛ржирзЗ ржХрзЛржирзЛ ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ ржирж╛ ржХрж░рзЗ, рждрж╛рж░ рж╕рзНржерж╛ржирзЗ ржПржХржЯрж┐ ржлрзНрж▓рзНржпрж╛ржЧ рж╕рзЗржЯ ржХрж░рж╛ рж╣рзЯ, ржпрж╛ рж╕рзЗржЗ ржбрж╛ржЯрж╛ржХрзЗ "ржбрж┐рж▓рж┐ржЯ" ржмрж╛ "ржЕржХрзНрж░рж┐рзЯ" рж╣рж┐рж╕рзЗржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд ржХрж░рзЗред ржПрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ ржПржЦржиржУ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ рж░рзЯрзЗ ржпрж╛рзЯ ржПржмржВ ржкрж░рзЗ ржкрзНрж░рзЯрзЛржЬржи рж╣рж▓рзЗ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

MongoDB рждрзЗ soft delete ржкрзНрж░ржХрзНрж░рж┐рзЯрж╛ ржЦрзБржмржЗ ржЬржиржкрзНрж░рж┐рзЯ ржХрж╛рж░ржг ржПржЯрж┐ ржбрж╛ржЯрж╛ рж╣рж╛рж░рж╛ржирзЛрж░ ржЭрзБржБржХрж┐ ржХржорж╛рзЯ ржПржмржВ ржЕрж╕рзНржерж╛рзЯрзАржнрж╛ржмрзЗ ржбрж╛ржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ рж╕рж╣ржЬ ржХрж░рзЗред

---

## тП╕я╕П 2. Why Soft Delete?

- **Data Retention:** ржбрж╛ржЯрж╛ ржпржжрж┐ ржХржЦржиржУ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рждрзЗ рж╣рзЯ, рждржмрзЗ ржПржЯрж┐ рж╕рж╣ржЬ рж╣ржмрзЗ ржХрж╛рж░ржг ржПржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржЕржмрж┐ржХрзГрждржнрж╛ржмрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд ржерж╛ржХржмрзЗред
- **Audit Trail:** ржЖржкржирж┐ ржХрж┐ ржХржЦржиржУ ржЬрж╛ржирждрзЗ ржЪрж╛ржи ржХрж┐ржнрж╛ржмрзЗ ржПржмржВ ржХржЦржи ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ рж╣рзЯрзЗржЫрж┐рж▓? Soft delete ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ рждрж╛ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред
- **Unwanted Deletion Prevention:** ржпржжрж┐ ржХрзЛржирзЛ ржнрзБрж▓ржмрж╢ржд ржбрж╛ржЯрж╛ ржбрж┐рж▓рж┐ржЯ рж╣рзЯрзЗ ржпрж╛рзЯ, рждржмрзЗ soft delete ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ рждрж╛ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рж╛ рж╕ржорзНржнржм рж╣ржмрзЗред

---

## тП╕я╕П 3. Create Schema with Soft Delete Flag

MongoDB рждрзЗ soft delete ржХрж░рж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ ржЖржорж╛ржжрзЗрж░ ржоржбрзЗрж▓ рж╕рзНржХрж┐ржорж╛рждрзЗ ржПржХржЯрж┐ **flag** ржлрж┐рж▓рзНржб ржпрзЛржЧ ржХрж░ржмрзЛ ржпрж╛ рж░рзЗржХрж░рзНржбржЯрж┐рж░ ржбрж┐рж▓рж┐ржЯ рж╕рзНржЯрзЗржЯрж╛рж╕ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░ржмрзЗред

### Example: User Model with Soft Delete

```js
const mongoose = require('mongoose');

const userSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true,
  },
  email: {
    type: String,
    required: true,
    unique: true,
  },
  deleted: {
    type: Boolean,
    default: false, // flag to indicate if user is deleted or not
  },
  createdAt: {
    type: Date,
    default: Date.now,
  },
});

const User = mongoose.model('User', userSchema);
module.exports = User;
```

### Explanation:

- **deleted:** ржПржЯрж┐ ржПржХржЯрж┐ **Boolean** ржлрзНрж▓рзНржпрж╛ржЧ ржпрж╛ рж░рзЗржХрж░рзНржбржЯрж┐рж░ ржбрж┐рж▓рж┐ржЯ рж╣ржУрзЯрж╛ ржирж╛ рж╣ржУрзЯрж╛ ржЪрж┐рж╣рзНржирж┐ржд ржХрж░рзЗред ржпржжрж┐ ржПржЯрж┐ `true` рж╣рзЯ, рждрж╛рж╣рж▓рзЗ рж░рзЗржХрж░рзНржбржЯрж┐ ржбрж┐рж▓рж┐ржЯрзЗржб рж╣рж┐рж╕рзЗржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд рж╣ржмрзЗред
- **default:** ржбрж┐ржлрж▓рзНржЯржнрж╛ржмрзЗ `false` ржерж╛ржХржмрзЗ, ржЕрж░рзНржерж╛рзО рж░рзЗржХрж░рзНржбржЯрж┐ ржбрж┐рж▓рж┐ржЯ рж╣ржУрзЯрж╛ рж╣рзЯржирж┐ред

---

## тП╕я╕П 4. Implement Soft Delete in Routes

ржПржЦржи ржЖржорж░рж╛ **soft delete** ржПрж░ ржЬржирзНржп ржПржХржЯрж┐ API рждрзИрж░рж┐ ржХрж░ржмрзЛред ржПржЗ API ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржбрж┐рж▓рж┐ржЯ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ, рждржмрзЗ ржбрж┐рж▓рж┐ржЯрзЗрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ **deleted** ржлрзНрж▓рзНржпрж╛ржЧржЯрж┐ `true` рж╕рзЗржЯ ржХрж░ржмрзЗред

### Soft Delete API Endpoint

```js
const express = require('express');
const mongoose = require('mongoose');
const User = require('./models/User');
const app = express();
const port = 3000;

app.use(express.json());

// Soft delete user by setting 'deleted' flag to true
app.delete('/user/:id', async (req, res) => {
  try {
    const { id } = req.params;

    // Find user by ID
    const user = await User.findById(id);
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }

    // Mark as deleted
    user.deleted = true;
    await user.save();

    res.status(200).json({ message: 'User soft deleted successfully', user });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
});

app.listen(port, () => {
  console.log(`Server running at http://localhost:${port}`);
});
```

### Explanation:

- **Find User by ID:** ржЖржорж░рж╛ ржкрзНрж░ржержорзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рждрж╛рж░ **ID** ржжрж┐рзЯрзЗ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж┐ред
- **Set Deleted Flag:** рждрж╛рж░ржкрж░ `deleted = true` ржХрж░рзЗ рж╕рзЗржЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ "ржбрж┐рж▓рж┐ржЯ" рж╣рж┐рж╕рзЗржмрзЗ ржЪрж┐рж╣рзНржирж┐ржд ржХрж░рж┐ред
- **Save User:** рж╢рзЗрж╖ржорзЗрж╢ ржЖржорж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ рж╕рзЗржн ржХрж░рж┐, ржпрж╛рждрзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржПржЗ ржкрж░рж┐ржмрж░рзНрждржиржЯрж┐ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣рзЯред

---

## тП╕я╕П 5. Implement Soft Delete in Queries

Soft delete ржХрж░рж╛рж░ ржкрж░, ржЖржкржирж┐ рж╕рж╛ржзрж╛рж░ржгржд ржбрж╛ржЯрж╛ржмрзЗржЬ ржерзЗржХрзЗ **ржбрж┐рж▓рж┐ржЯрзЗржб рж░рзЗржХрж░рзНржб**ржЧрзБрж▓рж┐ ржжрзЗржЦрждрзЗ ржЪрж╛ржи ржирж╛ред рждрж╛ржЗ ржЖржорж╛ржжрзЗрж░ **find** ржПржмржВ ржЕржирзНржпрж╛ржирзНржп queries ржП `deleted: false` ржлрж┐рж▓рзНржЯрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржЙржЪрж┐рждред

### Find All Non-deleted Users

```js
app.get('/users', async (req, res) => {
  try {
    const users = await User.find({ deleted: false });
    res.status(200).json(users);
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
});
```

### Explanation:

- **deleted: false:** ржПржЗ ржлрж┐рж▓рзНржЯрж╛рж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржорж░рж╛ рж╢рзБржзрзБржорж╛рждрзНрж░ **ржбрж┐рж▓рж┐ржЯрзЗржб ржирж╛ рж╣ржУрзЯрж╛** ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржжрзЗржЦрждрзЗ ржкрж╛ржЪрзНржЫрж┐ред

---

## тП╕я╕П 6. Restoring Soft Deleted Data

ржзрж░рж╛ ржпрж╛ржХ, ржпржжрж┐ ржЖржкржирж┐ ржХрзЛржи ржбрж┐рж▓рж┐ржЯрзЗржб рж░рзЗржХрж░рзНржб ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рждрзЗ ржЪрж╛ржи, рждрж╛рж╣рж▓рзЗ ржЖржкржирж┐ ржлрзНрж▓рзНржпрж╛ржЧржЯрж┐ ржЖржмрж╛рж░ `false` ржХрж░рзЗ ржжрж┐рждрзЗ ржкрж╛рж░рзЗржиред

### Restore Soft Deleted User

```js
app.put('/user/restore/:id', async (req, res) => {
  try {
    const { id } = req.params;

    // Find soft deleted user by ID
    const user = await User.findById(id);
    if (!user || !user.deleted) {
      return res.status(404).json({ message: 'User not found or not deleted' });
    }

    // Restore user by setting 'deleted' flag to false
    user.deleted = false;
    await user.save();

    res.status(200).json({ message: 'User restored successfully', user });
  } catch (error) {
    res.status(500).json({ message: error.message });
  }
});
```

### Explanation:

- **Find and Check Deleted Flag:** ржкрзНрж░ржержорзЗ ржЖржорж░рж╛ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж┐ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рж┐ ржпрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА **ржбрж┐рж▓рж┐ржЯрзЗржб** ржХрж┐ ржирж╛ред
- **Restore:** ржпржжрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржбрж┐рж▓рж┐ржЯрзЗржб ржерж╛ржХрзЗ, рждржмрзЗ ржЖржорж░рж╛ `deleted` ржлрзНрж▓рзНржпрж╛ржЧржЯрж┐ `false` ржХрж░рзЗ рждрж╛ржХрзЗ ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рж┐ред

---

## ЁЯУМ рж╕ржВржХрзНрж╖рзЗржкрзЗ, ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи:

- **Soft delete** ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ ржлрзНрж▓рзНржпрж╛ржЧ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж░рж╛ ржпрж╛рзЯред
- **Soft delete** ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ **ржЕрж╕рзНржерж╛рзЯрзАржнрж╛ржмрзЗ ржбрж┐рж▓рж┐ржЯ** ржХрж░рж╛ ржПржмржВ **ржкрзБржирж░рзБржжрзНржзрж╛рж░** ржХрж░рж╛ред
- ржХрж┐ржнрж╛ржмрзЗ **queries** ржП soft deleted ржбрж╛ржЯрж╛ ржлрж┐рж▓рзНржЯрж╛рж░ ржХрж░рж╛ ржпрж╛рзЯред
- ржХрж┐ржнрж╛ржмрзЗ **restore** ржХрж░рж╛ ржпрж╛рзЯ soft deleted ржбрж╛ржЯрж╛ред

ржПржЯрж┐ MongoDB рждрзЗ **soft delete** ржПрж░ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЕржВрж╢ ржЫрж┐рж▓ред ЁЯОЙЁЯЪА






# Day 55

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Wrap DB operations in transaction**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ рж╢рж┐ржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ **MongoDB рждрзЗ transaction** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрж╕рж╛ржерзЗ рж╕ржорзНржкржирзНржи ржХрж░рж╛ ржпрж╛рзЯред MongoDB 4.0 рж╕ржВрж╕рзНржХрж░ржг ржерзЗржХрзЗ **transactions** рж╕ржорж░рзНржерж┐ржд, ржпрж╛ ACID (Atomicity, Consistency, Isolation, Durability) ржЧрзБржгрж╛ржмрж▓рзА ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред

---

## тП╕я╕П 1. What is a Database Transaction?

**Database Transaction** ржПржоржи ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржпрж╛ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржХрж░рзНржоржкржжрзНржзрждрж┐ (operations) ржПржХрждрзНрж░рзЗ рж╕ржорзНржкрж╛ржжржи ржХрж░рзЗ, ржПржмржВ рж╕ржорж╕рзНржд ржХрж░рзНржоржкржжрзНржзрждрж┐ ржПржХрж╕рж╛ржерзЗ рж╕ржлрж▓ ржмрж╛ ржмрзНржпрж░рзНрже рж╣рждрзЗ рж╣ржмрзЗред ржПрж░ ржорж╛ржирзЗ рж╣рж▓ ржпрзЗ ржпржжрж┐ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржкрзБрж░рзЛ transaction ржмрзНржпрж░рзНрже рж╣рзЯрзЗ ржпрж╛ржмрзЗ ржПржмржВ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи ржЙрж▓рзНржЯрзЗ ржпрж╛ржмрзЗ (rollback)ред

ржПржХржЯрж┐ transaction рждрж┐ржиржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржЧрзБржгрж╛ржмрж▓рзА ржзрж╛рж░ржг ржХрж░рзЗ:
1. **Atomicity:** рж╕ржорж╕рзНржд ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрждрзНрж░рзЗ рж╕ржлрж▓ ржмрж╛ ржмрзНржпрж░рзНрже рж╣ржмрзЗред
2. **Consistency:** ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ ржЕржмрж╕рзНржерж╛ржи ржкрзВрж░рзНржмрзЗрж░ рж╕рж╛ржерзЗ рж╕ржЩрзНржЧрждрж┐ржкрзВрж░рзНржг ржерж╛ржХржмрзЗред
3. **Isolation:** ржПржХржЯрж┐ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржирзЗрж░ ржЕржкрж╛рж░рзЗрж╢ржи ржЕржирзНржп ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржирзЗрж░ рж╕рж╛ржерзЗ рж╣рж╕рзНрждржХрзНрж╖рзЗржк ржХрж░ржмрзЗ ржирж╛ред
4. **Durability:** рж╕ржлрж▓ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзЗрж╖ рж╣рж▓рзЗ, рждрж╛рж░ ржлрж▓рж╛ржлрж▓ ржЪрж┐рж░ржХрж╛рж▓ рж╕рзНржерж╛рзЯрзА рж╣ржмрзЗред

---

## тП╕я╕П 2. Why Use Transactions?

MongoDB рждрзЗ transactions ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ:
- **Consistency** ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рж╛ ржпрж╛рзЯ, ржпрзЗржЦрж╛ржирзЗ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрждрзНрж░рзЗ рж╕ржорзНржкрж╛ржжрж┐ржд рж╣рждрзЗ рж╣рзЯред
- **Data integrity** ржмржЬрж╛рзЯ рж░рж╛ржЦрж╛ ржпрж╛рзЯ, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржпржЦржи ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЯрзЗржмрж┐рж▓ ржмрж╛ ржХрзЛрж▓рзЗржХрж╢ржи ржПржХржЗ рж╕ржорзЯрзЗ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ рж╣рзЯред

---

## тП╕я╕П 3. How to Use Transactions in MongoDB?

MongoDB рждрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп, ржЖржорж░рж╛ **session** рждрзИрж░рж┐ ржХрж░рж┐ ржПржмржВ рж╕рзЗржЗ session ржПрж░ ржЕржзрзАржирзЗ рж╕ржорж╕рзНржд ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржорзНржкрж╛ржжржи ржХрж░рж┐ред ржпржжрж┐ ржХрзЛржирзЛ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, ржЖржорж░рж╛ **rollback** ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

---

## тП╕я╕П 4. Steps to Wrap DB Operations in a Transaction

ржПржЦржи ржЖржорж░рж╛ ржжрзЗржЦржмрзЛ ржХрж┐ржнрж╛ржмрзЗ **MongoDB рждрзЗ transaction** ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ рж╣рзЯред

### Example: Transfer Money Between Two Accounts (Transactional Operation)

ржЖржорж░рж╛ ржПржХржЯрж┐ ржЙржжрж╛рж╣рж░ржг рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрзЗржЦрж╛ржирзЗ ржПржХржЯрж┐ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржерзЗржХрзЗ ржЕржирзНржп ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯрзЗ ржЯрж╛ржХрж╛ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░ ржХрж░рж╛ рж╣ржмрзЗред ржПржЗ ржХрж╛ржЬржЯрж┐ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржорзНржкржирзНржи ржХрж░рзЗ, рждрж╛ржЗ ржЖржорж░рж╛ ржПржЯрж┐ ржПржХржЯрж┐ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржирзЗ рж░рж╛ржЦрждрзЗ ржЪрж╛ржЗред

### 4.1. Transaction Setup & Handling

```js
const mongoose = require('mongoose');

// Define schemas for Account model
const accountSchema = new mongoose.Schema({
  name: String,
  balance: Number,
});

const Account = mongoose.model('Account', accountSchema);

const transferMoney = async (senderId, receiverId, amount) => {
  const session = await mongoose.startSession();
  session.startTransaction();

  try {
    const sender = await Account.findById(senderId).session(session);
    const receiver = await Account.findById(receiverId).session(session);

    if (!sender || !receiver) {
      throw new Error('Sender or Receiver not found');
    }

    // Check if sender has enough balance
    if (sender.balance < amount) {
      throw new Error('Insufficient balance');
    }

    // Deduct from sender and add to receiver
    sender.balance -= amount;
    receiver.balance += amount;

    // Save both documents
    await sender.save();
    await receiver.save();

    // Commit the transaction
    await session.commitTransaction();
    session.endSession();
    console.log('Transaction successful');
  } catch (error) {
    // Rollback the transaction in case of error
    await session.abortTransaction();
    session.endSession();
    console.error('Transaction failed', error);
  }
};
```

### Explanation:

1. **Start a session**: 
   - ржкрзНрж░ржержорзЗ ржПржХржЯрж┐ session рж╢рзБрж░рзБ ржХрж░рж╛ рж╣рзЯ `mongoose.startSession()` ржПрж░ ржорж╛ржзрзНржпржорзЗред
2. **Start Transaction**:
   - рждрж╛рж░ржкрж░ рж╕рзЗржЗ session ржП ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи рж╢рзБрж░рзБ ржХрж░рж╛ рж╣рзЯ `session.startTransaction()` ржжрж┐рзЯрзЗред
3. **Perform DB Operations**:
   - `findById()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ sender ржПржмржВ receiver ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржЦрзЛржБржЬрж╛ рж╣рзЯ ржПржмржВ рж╕рзЗржЗ session ржП ржХрж╛рж░рзНржпржХрзНрж░ржо ржХрж░рж╛ рж╣рзЯред
   - ржПрж░ ржкрж░рзЗ sender ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржерзЗржХрзЗ ржЯрж╛ржХрж╛ ржХрж╛ржЯрж╛ рж╣рзЯ ржПржмржВ receiver ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯрзЗ ржпрзЛржЧ ржХрж░рж╛ рж╣рзЯред
4. **Commit Transaction**:
   - рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрж▓рзЗ, `session.commitTransaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржХржорж┐ржЯ ржХрж░рж╛ рж╣рзЯред
5. **Rollback Transaction**:
   - ржпржжрж┐ ржХрзЛржирзЛ error ржШржЯрзЗ, рждрж╛рж╣рж▓рзЗ `session.abortTransaction()` ржПрж░ ржорж╛ржзрзНржпржорзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржмрж╛рждрж┐рж▓ ржХрж░рж╛ рж╣рзЯ ржПржмржВ ржХрзЛржи ржкрж░рж┐ржмрж░рзНрждржи ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж╕рзЗржн рж╣рзЯ ржирж╛ред

---

## тП╕я╕П 5. Using Transactions with Multiple Collections

MongoDB рждрзЗ ржПржХрж╛ржзрж┐ржХ ржХрзЛрж▓рзЗржХрж╢ржирзЗрж░ ржоржзрзНржпрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ рж╕ржорзНржнржмред ржЖржкржирж┐ ржпржжрж┐ ржПржХрж╛ржзрж┐ржХ ржХрзЛрж▓рзЗржХрж╢ржирзЗ ржбрж╛ржЯрж╛ ржЖржкржбрзЗржЯ ржХрж░рждрзЗ ржЪрж╛ржи, рждржмрзЗ рж╕рзЗржЧрзБрж▓рж┐ржУ ржПржХржЯрж┐ рж╕рзЗрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрждрзНрж░рзЗ рж╕ржорзНржкржирзНржи ржХрж░рждрзЗ рж╣ржмрзЗред

```js
const orderSchema = new mongoose.Schema({
  productId: mongoose.Schema.Types.ObjectId,
  userId: mongoose.Schema.Types.ObjectId,
  quantity: Number,
  status: String,
});

const Order = mongoose.model('Order', orderSchema);

const createOrderAndDeductStock = async (userId, productId, quantity) => {
  const session = await mongoose.startSession();
  session.startTransaction();

  try {
    // Create order
    const order = new Order({ productId, userId, quantity, status: 'pending' });
    await order.save({ session });

    // Deduct stock from product (assuming we have a Product model)
    const product = await Product.findById(productId).session(session);
    if (!product || product.stock < quantity) {
      throw new Error('Insufficient stock');
    }

    product.stock -= quantity;
    await product.save({ session });

    // Commit transaction
    await session.commitTransaction();
    session.endSession();
    console.log('Order created and stock updated');
  } catch (error) {
    // Rollback in case of error
    await session.abortTransaction();
    session.endSession();
    console.error('Order creation failed', error);
  }
};
```

### Explanation:

- ржЖржорж░рж╛ ржПржЦрж╛ржирзЗ **Order** ржХрзЛрж▓рзЗржХрж╢ржирзЗрж░ рж╕рж╛ржерзЗ **Product** ржХрзЛрж▓рзЗржХрж╢ржиржХрзЗржУ ржЖржкржбрзЗржЯ ржХрж░ржЫрж┐ред
- transaction ржПрж░ ржорж╛ржзрзНржпржорзЗ **order** ржПржмржВ **stock** ржПржХржпрзЛржЧрзЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗред
- ржпржжрж┐ ржХрзЛржирзЛ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждржЦржи **rollback** рж╣ржмрзЗ ржПржмржВ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи ржмрж╛рждрж┐рж▓ рж╣рзЯрзЗ ржпрж╛ржмрзЗред

---

## ЁЯУМ Summary:

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи ржХрж┐ржнрж╛ржмрзЗ MongoDB рждрзЗ **transaction** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрж╕рж╛ржерзЗ рж╕ржорзНржкрж╛ржжржи ржХрж░рждрзЗ рж╣рзЯред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржжрзЗржЦрзЗржЫрж┐ ржХрж┐ржнрж╛ржмрзЗ:
- **Transaction** рж╢рзБрж░рзБ ржПржмржВ рж╢рзЗрж╖ ржХрж░рж╛ рж╣рзЯред
- ржПржХрж╛ржзрж┐ржХ **collections** ржПрж░ ржоржзрзНржпрзЗ **atomic** (ржПржХржХ) ржЕржкрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛ ржпрж╛рзЯред
- **Commit** ржПржмржВ **Rollback** ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред

ржПржЯрж┐ ржЦрзБржмржЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржПржХржЯрж┐ ржжржХрзНрж╖рждрж╛ ржпржЦржи ржЖржкржирж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ рж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рзЗржи, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржпржЦржи ржЖржкржирж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рждрзЗ ржЪрж╛ржи ржпрзЗ рж╕ржорж╕рзНржд ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржпрзЛржЧрзЗ рж╕ржлрж▓ ржмрж╛ ржмрзНржпрж░рзНрже рж╣ржмрзЗред ЁЯЪА




# Day 56

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Mini project: E-commerce checkout logic with rollback**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ ржПржХржЯрж┐ **E-commerce checkout logic** рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрзЗржЦрж╛ржирзЗ **rollback** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржмрзЗред ржПржЯрж┐ ржПржХржЯрж┐ ржорж┐ржирж┐ржкрзНрж░ржЬрзЗржХрзНржЯ ржпрж╛ **MongoDB transaction** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржПржХржЯрж┐ **checkout process** ржмрж╛рж╕рзНрждржмрж╛рзЯржи ржХрж░ржмрзЗ, ржпрзЗржЦрж╛ржирзЗ ржмрж┐ржнрж┐ржирзНржи ржЕржкрж╛рж░рзЗрж╢ржи ржпрзЗржоржи **order creation**, **inventory update**, ржПржмржВ **payment processing** ржПржХржпрзЛржЧрзЗ рж╕ржорзНржкржирзНржи ржХрж░рж╛ рж╣ржмрзЗред ржпржжрж┐ ржХрзЛржирзЛ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждржЦржи **rollback** рж╣ржмрзЗ ржПржмржВ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи ржкрзВрж░рзНржмрж╛ржмрж╕рзНржерж╛рзЯ ржлрж┐рж░рзЗ ржпрж╛ржмрзЗред

---

## тП╕я╕П 1. Project Overview

ржЖржорж░рж╛ ржПржХржЯрж┐ **E-commerce checkout system** рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрзЗржЦрж╛ржирзЗ ржЧрзНрж░рж╛рж╣ржХ ржПржХржЯрж┐ ржкржгрзНржп ржХрж┐ржиржмрзЗ, ржкржгрзНржпрзЗрж░ ржкрж░рж┐ржорж╛ржг рж╕рзНржЯржХ ржерзЗржХрзЗ ржХржорж╛ржирзЛ рж╣ржмрзЗ ржПржмржВ ржПржХржЯрж┐ **order** рждрзИрж░рж┐ рж╣ржмрзЗред ржпржжрж┐ ржХрзЛржирзЛ ржПржХржЯрж┐ ржзрж╛ржкрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ (ржпрзЗржоржи, **payment failure** ржмрж╛ **insufficient stock**), рждрж╛рж╣рж▓рзЗ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи **rollback** рж╣рзЯрзЗ ржпрж╛ржмрзЗ ржПржмржВ ржЧрзНрж░рж╛рж╣ржХржХрзЗ рж╕ржарж┐ржХ рждржерзНржп ржЬрж╛ржирж╛ржирзЛ рж╣ржмрзЗред

---

## тП╕я╕П 2. Steps to Implement Checkout Logic

### Step 1: Define the Models
ржЖржорж░рж╛ рзйржЯрж┐ ржоржбрзЗрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛ:
1. **Product** - ржпрзЗржЦрж╛ржирзЗ ржкржгрзНржпрзЗрж░ рждржерзНржп ржерж╛ржХржмрзЗ (ржпрзЗржоржи ржирж╛ржо, ржжрж╛ржо, рж╕рзНржЯржХ ржкрж░рж┐ржорж╛ржг)
2. **Order** - ржпрзЗржЦрж╛ржирзЗ ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржЕрж░рзНржбрж╛рж░рзЗрж░ рждржерзНржп ржерж╛ржХржмрзЗ (ржпрзЗржоржи ржкржгрзНржпрзЗрж░ рждржерзНржп, ржкрж░рж┐ржорж╛ржг, рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕)
3. **Payment** - ржпрзЗржЦрж╛ржирзЗ ржкрзЗржорзЗржирзНржЯ рж╕ржорзНржкрж░рзНржХрж┐ржд рждржерзНржп ржерж╛ржХржмрзЗ (ржпрзЗржоржи ржкрзЗржорзЗржирзНржЯ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕)

### Step 2: Start Transaction for Checkout
ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХрждрзНрж░рзЗ ржХрж░ржмрзЛ:
- ржкржгрзНржпрзЗрж░ рж╕рзНржЯржХ ржХржорж╛ржирзЛ
- ржирждрзБржи ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛
- ржкрзЗржорзЗржирзНржЯ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рж╛

ржпржжрж┐ ржХрзЛржирзЛ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ, рждржЦржи ржЖржорж░рж╛ **rollback** ржХрж░ржмрзЛ ржпрж╛рждрзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржХрзЛржирзЛ ржЕрж╕рзНржмрж╛ржнрж╛ржмрж┐ржХ ржкрж░рж┐ржмрж░рзНрждржи ржирж╛ рж╣рзЯред

### Step 3: Rollback in Case of Failure
ржпржжрж┐ ржХрзЛржирзЛ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯ (ржпрзЗржоржи ржкрзЗржорзЗржирзНржЯрзЗрж░ рж╕ржорзЯ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ), рждржЦржи ржЖржорж░рж╛ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи **abort** ржХрж░рзЗ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи **rollback** ржХрж░ржмрзЛред

---

## тП╕я╕П 3. Code Implementation

### 3.1. Define Product, Order, and Payment Models

```js
const mongoose = require('mongoose');

// Product Model
const productSchema = new mongoose.Schema({
  name: String,
  price: Number,
  stock: Number,
});

const Product = mongoose.model('Product', productSchema);

// Order Model
const orderSchema = new mongoose.Schema({
  productId: mongoose.Schema.Types.ObjectId,
  quantity: Number,
  totalAmount: Number,
  status: String,
});

const Order = mongoose.model('Order', orderSchema);

// Payment Model
const paymentSchema = new mongoose.Schema({
  orderId: mongoose.Schema.Types.ObjectId,
  paymentStatus: String,
  paymentAmount: Number,
});

const Payment = mongoose.model('Payment', paymentSchema);
```

### 3.2. Checkout Logic with Transaction

```js
const checkout = async (userId, productId, quantity) => {
  const session = await mongoose.startSession();
  session.startTransaction();

  try {
    // Step 1: Check Product Availability
    const product = await Product.findById(productId).session(session);
    if (!product || product.stock < quantity) {
      throw new Error('Insufficient stock');
    }

    // Step 2: Create Order
    const totalAmount = product.price * quantity;
    const order = new Order({
      productId,
      quantity,
      totalAmount,
      status: 'pending',
    });
    await order.save({ session });

    // Step 3: Process Payment (Simulated)
    const paymentStatus = 'success'; // Simulate payment status
    if (paymentStatus !== 'success') {
      throw new Error('Payment failed');
    }

    // Step 4: Create Payment Record
    const payment = new Payment({
      orderId: order._id,
      paymentStatus,
      paymentAmount: totalAmount,
    });
    await payment.save({ session });

    // Step 5: Update Product Stock
    product.stock -= quantity;
    await product.save({ session });

    // Commit Transaction
    await session.commitTransaction();
    session.endSession();
    console.log('Checkout completed successfully');
  } catch (error) {
    // Rollback Transaction in case of failure
    await session.abortTransaction();
    session.endSession();
    console.error('Checkout failed:', error);
  }
};
```

### Explanation of Code:

1. **Session Start**: ржЖржорж░рж╛ ржкрзНрж░ржержорзЗ ржПржХржЯрж┐ session рж╢рзБрж░рзБ ржХрж░рж┐ `mongoose.startSession()` ржжрж┐рзЯрзЗ, ржпрж╛рждрзЗ transaction ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ ржкрж╛рж░рж┐ред
2. **Product Availability Check**: ржкржгрзНржпрзЗрж░ рж╕рзНржЯржХ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣рзЯ, ржпржжрж┐ ржкрж░рзНржпрж╛ржкрзНржд рж╕рзНржЯржХ ржирж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ error throw ржХрж░рж╛ рж╣рзЯ ржПржмржВ transaction abort рж╣рзЯрзЗ ржпрж╛ржмрзЗред
3. **Order Creation**: ржЧрзНрж░рж╛рж╣ржХрзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржирждрзБржи ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯ ржПржмржВ рж╕рзЗржЯрж┐ **Order** ржХрзЛрж▓рзЗржХрж╢ржирзЗ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛ рж╣рзЯред
4. **Payment Processing**: ржкрзЗржорзЗржирзНржЯ ржкрзНрж░рж╕рзЗрж╕ ржХрж░рж╛ рж╣рзЯ, ржПржмржВ ржпржжрж┐ ржкрзЗржорзЗржирзНржЯ ржмрзНржпрж░рзНрже рж╣рзЯ (ржпрзЗржоржи simulated payment failure), рждржЦржи transaction abort рж╣рзЯрзЗ ржпрж╛ржмрзЗред
5. **Product Stock Update**: ржкржгрзНржпрзЗрж░ рж╕рзНржЯржХ ржХржорж╛ржирзЛ рж╣рзЯ, ржПржЯрж┐ рж╢рзБржзрзБ рждржЦржиржЗ рж╣ржмрзЗ ржпржжрж┐ рж╕ржмржХрж┐ржЫрзБ рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржорзНржкржирзНржи рж╣рзЯред
6. **Commit or Rollback**: ржпржжрж┐ рж╕ржорж╕рзНржд ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржлрж▓ рж╣рзЯ, ржЖржорж░рж╛ **commitTransaction()** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржи ржХржорж┐ржЯ ржХрж░рж┐ред ржпржжрж┐ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, ржЖржорж░рж╛ **abortTransaction()** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржиржЯрж┐ ржмрж╛рждрж┐рж▓ ржХрж░рж┐ ржПржмржВ рж╕ржорж╕рзНржд ржкрж░рж┐ржмрж░рзНрждржи ржЙрж▓рзНржЯрзЗ ржпрж╛ржмрзЗред

---

## тП╕я╕П 4. Testing the Checkout Logic

ржЖржкржирж╛рж░ ржХрзЛржб рж╕ржлрж▓ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ ржЬржирзНржп, ржЖржкржирж┐ ржмрж┐ржнрж┐ржирзНржи ржкрж░рж┐рж╕рзНржерж┐рждрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:
1. **Insufficient stock**: ржкржгрзНржпрзЗрж░ рж╕рзНржЯржХ ржХржо ржерж╛ржХрж▓рзЗ ржЕрж░рзНржбрж╛рж░ рж╣ржмрзЗ ржирж╛ ржПржмржВ rollback рж╣ржмрзЗред
2. **Payment failure**: ржпржжрж┐ ржкрзЗржорзЗржирзНржЯ ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ рж╕ржорж╕рзНржд ржбрж╛ржЯрж╛ржмрзЗрж╕ ржкрж░рж┐ржмрж░рзНрждржи rollback рж╣ржмрзЗред
3. **Successful checkout**: рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХржарж╛ржХ ржерж╛ржХрж▓рзЗ, ржЕрж░рзНржбрж╛рж░ рждрзИрж░рж┐ рж╣ржмрзЗ, рж╕рзНржЯржХ ржЖржкржбрзЗржЯ рж╣ржмрзЗ ржПржмржВ ржкрзЗржорзЗржирзНржЯ рж╕ржВрж░ржХрзНрж╖ржг рж╣ржмрзЗред

---

## ЁЯУМ Summary:

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржкржирж┐ рж╢рж┐ржЦрж▓рзЗржи ржХрж┐ржнрж╛ржмрзЗ **E-commerce checkout logic** рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣рзЯ MongoDB **transaction** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗред ржПржЦрж╛ржирзЗ ржЖржорж░рж╛ ржжрзЗржЦрзЗржЫрж┐:
- ржПржХрж╛ржзрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи ржпрзЗржоржи **order creation**, **inventory update**, ржПржмржВ **payment processing** ржПржХржпрзЛржЧрзЗ рж╕ржорзНржкржирзНржи ржХрж░рждрзЗред
- **Rollback** ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ ржпржЦржи ржХрзЛржирзЛ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣рзЯред
- ржХрж┐ржнрж╛ржмрзЗ ржЯрзНрж░рж╛ржиржЬрзЗржХрж╢ржирзЗрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗрж░ integrity рж░ржХрзНрж╖рж╛ ржХрж░рж╛ ржпрж╛рзЯред

ржПржЯрж┐ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржжржХрзНрж╖рждрж╛, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржпржЦржи ржЖржкржирж┐ ржмрзЬ E-commerce рж╕рж┐рж╕рзНржЯрзЗржо рждрзИрж░рж┐ ржХрж░рзЗржи, ржпрзЗржЦрж╛ржирзЗ ржмрж┐ржнрж┐ржирзНржи ржбрж╛ржЯрж╛ржмрзЗрж╕ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржпрзЛржЧрзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ рж╣рзЯред ЁЯЪА



# Day 56

тЬЕ **ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐: Caching**

ржЖржЬржХрзЗрж░ ржжрж┐ржирзЗ ржЖржорж░рж╛ **Caching** ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░ржмрзЛред Caching рж╣рж▓ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржХрзМрж╢рж▓ ржпрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕, ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи, ржПржмржВ API ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЙржирзНржиржд ржХрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред ржПрждрзЗ ржХрж░рж╛ рж╣рзЯ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржбрзЗржЯрж╛ ржкрзБржирж░рж╛рзЯ ржмрж╛рж░ржмрж╛рж░ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржмрж╛ ржЕржирзНржп ржЙрзОрж╕ ржерзЗржХрзЗ рж░рж┐ржЯрзНрж░рж┐ржн ржХрж░рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ рждрж╛ ржПржХ ржЬрж╛рзЯржЧрж╛рзЯ рж╕ржЮрзНржЪрзЯ ржХрж░рж╛, ржпрж╛рждрзЗ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржжрзНрж░рзБржд ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛рзЯред

Caching ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ, ржЖржорж░рж╛ ржмрж╛рж░ржмрж╛рж░ ржПржХржЗ ржбрзЗржЯрж╛ ржкрзБржирж░рзБржжрзНржзрж╛рж░рзЗрж░ рж╕ржорзЯрзЗрж░ ржЬржирзНржп ржмрзНржпрзЯ ржХржорж╛рждрзЗ ржкрж╛рж░рж┐ ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржирзЗржХ ржжрзНрж░рзБржд ржХрж░рждрзЗ ржкрж╛рж░рж┐ред

---

## тП╕я╕П 1. What is Caching?

**Caching** рж╣рж▓ ржПржХржЯрж┐ ржкржжрзНржзрждрж┐ ржпрзЗржЦрж╛ржирзЗ ржХржорзНржкрж┐ржЙржЯрж┐ржВ рж░рж┐рж╕рзЛрж░рзНрж╕ (ржпрзЗржоржи ржбрзЗржЯрж╛ржмрзЗрж╕) ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржмрж╛рж░ржмрж╛рж░ ржмрзЗрж░ ржХрж░рж╛рж░ ржкрж░рж┐ржмрж░рзНрждрзЗ рждрж╛ ржХрж┐ржЫрзБ рж╕ржорзЯрзЗрж░ ржЬржирзНржп **temporary storage** ржмрж╛ **cache**-ржП рж░рж╛ржЦрж╛рж░ ржорж╛ржзрзНржпржорзЗ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЙржирзНржиржд ржХрж░рж╛ рж╣рзЯред 

Caching рж╕рж╛ржзрж╛рж░ржгржд ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯ:
- API ржмрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржкрзНрж░рж╛ржкрзНрждрж┐рж░ рж╕ржорзЯ ржЦрж░ржЪ ржХржорж╛ржирзЛрж░ ржЬржирзНржпред
- ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЬржирзНржп ржжрзНрж░рзБрждрждрж░ ржЕржнрж┐ржЬрзНржЮрждрж╛ рждрзИрж░рж┐рж░ ржЬржирзНржпред

---

## тП╕я╕П 2. Types of Caching

### 2.1. **In-memory Caching**
- ржПржЯрж┐ ржПржХржзрж░ржирзЗрж░ **volatile memory** caching, ржпрзЗржЦрж╛ржирзЗ ржбрзЗржЯрж╛ RAM-ржП рж╕ржЮрзНржЪрж┐ржд рж╣рзЯред
- ржПржЯрж┐ ржЕржирзЗржХ ржжрзНрж░рзБржд, рждржмрзЗ **server restart** рж╣рж▓рзЗ ржбрзЗржЯрж╛ рж╣рж╛рж░рж┐рзЯрзЗ ржпрж╛рзЯред

### 2.2. **Persistent Caching**
- ржПржЦрж╛ржирзЗ ржбрзЗржЯрж╛ рж╕рзНржЯрзЛрж░рзЗржЬ ржбрж┐ржнрж╛ржЗрж╕ ржмрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж╕ржЮрзНржЪрж┐ржд ржерж╛ржХрзЗред
- ржПржЗ ржзрж░ржирзЗрж░ ржХрзНржпрж╛рж╢рж┐ржВ ржжрзАрж░рзНржШрж╕рзНржерж╛рзЯрзА, ржПржмржВ ржбрзЗржЯрж╛ **server restart** рж╣ржУрзЯрж╛рж░ ржкрж░ржУ ржЕржЯрзЛржорзЗржЯрж┐ржХрзНржпрж╛рж▓рж┐ рж░рж┐рж╕рзНржЯрзЛрж░ рж╣рзЯред

---

## тП╕я╕П 3. Popular Caching Strategies

### 3.1. **Cache Aside**
- ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржкрзНрж░ржержорзЗ ржбрзЗржЯрж╛ ржХрзНржпрж╛рж╢рзЗ рж░рзЗржЦрзЗ, рждрж╛рж░ржкрж░ рж╕рзЗржЯрж┐ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ рж░рж┐ржЯрзНрж░рж┐ржн ржХрж░рзЗред
- ржПржХржмрж╛рж░ ржбрзЗржЯрж╛ ржХрзНржпрж╛рж╢рзЗ ржЪрж▓рзЗ ржЖрж╕рж▓рзЗ, ржкрж░ржмрж░рзНрждрзА рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж╕рж░рж╛рж╕рж░рж┐ ржХрзНржпрж╛рж╢ ржерзЗржХрзЗ ржЖрж╕рзЗред
- **Pros**: ржЕржзрж┐ржХ ржХржирзНржЯрзНрж░рзЛрж▓, ржкрзНрж░рзЯрзЛржЬржи ржЕржирзБржпрж╛рзЯрзА ржХрзНржпрж╛рж╢ ржХрж░рж╛ ржпрж╛рзЯред
- **Cons**: ржХрзНржпрж╛рж╢рзЗ ржбрзЗржЯрж╛ рж╕ржарж┐ржХ ржерж╛ржХрждрзЗ рж╣ржмрзЗ, ржПржмржВ cache miss рж╣рж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржирж┐рзЯрзЗ ржЖрж╕рж╛ рж╕ржорзЯрж╕рж╛ржкрзЗржХрзНрж╖ рж╣рждрзЗ ржкрж╛рж░рзЗред

### 3.2. **Read-through Cache**
- ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржпржЦржи ржбрзЗржЯрж╛ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржХрж░рзЗ, ржХрзНржпрж╛рж╢ ржкрзНрж░ржержорзЗ ржЪрзЗржХ ржХрж░рзЗ, ржпржжрж┐ ржбрзЗржЯрж╛ ржирж╛ ржерж╛ржХрзЗ, рждрж╛рж╣рж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржПржирзЗ ржХрзНржпрж╛рж╢рзЗ рж░рж╛ржЦрзЗред
- **Pros**: ржХрзНржпрж╛рж╢ ржЖржкржбрзЗржЯ ржХрж░рж╛рж░ ржЭрж╛ржорзЗрж▓рж╛ ржХржоред
- **Cons**: ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛ ржХржарж┐ржи рж╣рждрзЗ ржкрж╛рж░рзЗред

### 3.3. **Write-through Cache**
- ржпржЦржи ржбрзЗржЯрж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ рж▓рзЗржЦрж╛ рж╣рзЯ, рждржЦржи рж╕рзЗржЯрж╛ ржХрзНржпрж╛рж╢рзЗржУ рж▓рзЗржЦрж╛ рж╣рзЯред
- **Pros**: ржХрзНржпрж╛рж╢ ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржжрзБржЯрж┐ ржПржХржЗ ржбрзЗржЯрж╛ ржзрж╛рж░ржг ржХрж░рзЗред
- **Cons**: ржбрзЗржЯрж╛ ржЖржкржбрзЗржЯрзЗрж░ рж╕ржорзЯ ржмрзЗрж╢рж┐ рж╕ржорзЯ рж▓рж╛ржЧрзЗред

---

## тП╕я╕П 4. Implementing Caching in Express.js

ржПржЦржи ржЖржорж░рж╛ **Express.js** ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржХрзНржпрж╛рж╢рж┐ржВ ржХрж┐ржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рж┐, рж╕рзЗржЯрж┐ ржжрзЗржЦржмред

### 4.1. Use `redis` for Caching

ржЖржорж░рж╛ ржПржЦрж╛ржирзЗ **Redis** ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЛ, ржпрж╛ ржПржХржЯрж┐ ржЬржиржкрзНрж░рж┐рзЯ **in-memory caching** рж╕рж┐рж╕рзНржЯрзЗржоред Redis ржЦрзБржм ржжрзНрж░рзБржд ржХрж╛ржЬ ржХрж░рзЗ ржПржмржВ рж╕рж╛ржзрж╛рж░ржгржд **key-value store** рж╣рж┐рж╕рзЗржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред

#### Install Redis:

```bash
npm install redis
```

#### Setting Up Redis Cache:

```js
const redis = require('redis');
const client = redis.createClient(); // Create Redis client

client.on('connect', () => {
  console.log('Connected to Redis');
});

// Set data in cache
client.set('user:123', JSON.stringify({ name: 'John', age: 30 }));

// Get data from cache
client.get('user:123', (err, data) => {
  if (err) throw err;
  console.log('Data from cache:', JSON.parse(data));
});
```

### 4.2. Cache API Response in Express

```js
const express = require('express');
const redis = require('redis');
const client = redis.createClient();
const app = express();

client.on('connect', () => {
  console.log('Connected to Redis');
});

app.get('/api/products', (req, res) => {
  const cacheKey = 'products';
  
  // Check if data is in cache
  client.get(cacheKey, (err, data) => {
    if (data) {
      console.log('Data from cache');
      return res.json(JSON.parse(data));
    }

    // Fetch data from DB if not in cache
    // Simulating fetching from database
    const products = [
      { id: 1, name: 'Product A' },
      { id: 2, name: 'Product B' },
    ];

    // Set data in cache with an expiry time of 1 hour
    client.setex(cacheKey, 3600, JSON.stringify(products));

    console.log('Data from database');
    return res.json(products);
  });
});

app.listen(3000, () => {
  console.log('Server running on port 3000');
});
```

### Explanation:
1. **Redis Client**: ржЖржорж░рж╛ Redis client рж╕рзЗржЯ ржЖржк ржХрж░рзЗржЫрж┐ ржПржмржВ Express.js ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрж┐ред
2. **Check Cache**: API рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯрзЗрж░ ржЖржЧрзЗржЗ ржЖржорж░рж╛ Redis cache ржЪрзЗржХ ржХрж░рж┐ред ржпржжрж┐ ржбрзЗржЯрж╛ ржерж╛ржХрзЗ, рждржЦржи рждрж╛ рж╕рж░рж╛рж╕рж░рж┐ рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рж┐ред
3. **Database Fallback**: ржпржжрж┐ cache ржирж╛ ржерж╛ржХрзЗ, рждржЦржи ржЖржорж░рж╛ ржбрж╛ржЯрж╛ржмрзЗрж╕ ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржлрзЗржЪ ржХрж░рж┐ ржПржмржВ рждрж╛ Redis cache-ржП рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж┐ред

---

## тП╕я╕П 5. Cache Expiry

Redis ржХрзНржпрж╛рж╢рзЗ ржерж╛ржХрж╛ ржбрзЗржЯрж╛рж░ ржЬржирзНржп ржЖржкржирж┐ **expiry time** рж╕рзЗржЯ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи, ржпрж╛ ржХрзНржпрж╛рж╢рзЗ ржерж╛ржХрж╛ ржбрзЗржЯрж╛ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╕ржорзЯ ржкрж░ ржорзБржЫрзЗ ржлрзЗрж▓ржмрзЗред

```js
client.setex('user:123', 3600, JSON.stringify({ name: 'John', age: 30 }));
```
ржПржЦрж╛ржирзЗ, `3600` рж╕рзЗржХрзЗржирзНржбрзЗрж░ ржоржзрзНржпрзЗ ржХрзНржпрж╛рж╢рзЗрж░ ржбрзЗржЯрж╛ ржорзБржЫрзЗ ржпрж╛ржмрзЗред

---

## тП╕я╕П 6. Cache Invalidation

ржХрзНржпрж╛рж╢ ржЗржиржнрзНржпрж╛рж▓рж┐ржбрзЗрж╢ржи ржмрж╛ ржХрзНржпрж╛рж╢рзЗрж░ ржбрзЗржЯрж╛ ржЦрж╛рж▓рж┐ ржХрж░рж╛ ржЕржирзЗржХ рж╕ржорзЯ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рж╣рзЯрзЗ ржкрзЬрзЗ ржпржЦржи ржбрзЗржЯрж╛ ржкрж░рж┐ржмрж░рзНрждржи рж╣рзЯред Redis-ржП ржХрзНржпрж╛рж╢ ржорзБржЫрзЗ ржлрзЗрж▓рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи:

```js
client.del('user:123'); // Remove data from cache
```

---

## ЁЯУМ Summary:

ржЖржЬржХрзЗрж░ ржжрж┐ржиржЯрж┐ ржЫрж┐рж▓ **Caching** ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░рж╛рж░ ржжрж┐ржиред Caching ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЙржирзНржиржд ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред **Redis** рж╣рж▓рзЛ ржПржХржЯрж┐ ржЬржиржкрзНрж░рж┐рзЯ **in-memory caching** ржЯрзБрж▓ ржпрж╛ ржЖржкржирж┐ Express.js ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ рж╕рж╣ржЬрзЗржЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред

Caching рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржоржзрзНржпрзЗ **cache miss** ржПржмржВ **cache hit** ржмрзБржЭрзЗ ржХрж╛ржЬ ржХрж░рж╛ ржЕрждрзНржпржирзНржд ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг, ржПржмржВ ржХрзНржпрж╛рж╢рзЗрж░ ржбрзЗржЯрж╛ рж╕ржарж┐ржХ ржУ рж╕ржЩрзНржЧрждрж┐ржкрзВрж░рзНржг рж░рж╛ржЦрждрзЗ **cache invalidation** рж╕ржарж┐ржХржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЙржкрж░ ржЧрзБрж░рзБрждрзНржм ржжрзЗржУрзЯрж╛ ржЙржЪрж┐рждред

ржПржЯрж┐ ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржжржХрзНрж╖рждрж╛, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ ржпржЦржи ржЖржкржирж┐ **high-performance** ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рждрзИрж░рж┐ ржХрж░рзЗржиред ЁЯЪА





